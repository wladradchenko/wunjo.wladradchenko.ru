function getFileFormat(e){let t="other";switch(e.split(".")[e.split(".").length-1]){case"jpg":case"jpeg":case"png":case"gif":t="image";break;case"mp4":case"mov":case"avi":t="video";break;case"mp3":case"wav":case"ogg":t="audio"}return t}function generateRandomUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function getFileMetadataDate(e){var t,n;return e?(t=(e=new Date(1e3*e)).getFullYear(),n=e.getMonth(),{day:e.getDate(),month:n,year:t}):{day:null,month:null,year:null}}let viewSystem=userFileTree;const currentPaths=new Set;function initViewContent(e=null){(e.includes("group")?initViewContentGroup:initViewContentUniq)(e)}function initViewContentGroup(e=null){const o=window.location.origin;var t=JSON.parse(JSON.stringify(viewSystem));t.forEach(a=>{a.isDirectory?a.child.forEach(n=>{n.isDirectory?n.child.forEach((e,t)=>{e.isDirectory||(e.fullPath=`${o}/media/content/${userContentId}/${moduleName}/${a.name}/${n.name}/`+e.name,e.fileFormat=getFileFormat(e.name),e.index=t,e.useFile=!0)}):(n.fullPath=`${o}/media/content/${userContentId}/${moduleName}/${a.name}/`+n.name,n.fileFormat=getFileFormat(n.name),n.useFile=!1)}):(a.fullPath=`${o}/media/content/${userContentId}/${moduleName}/`+a.name,a.fileFormat=null,a.useFile=null)}),setupViewContentGroup(t,e)}function setupViewContentGroup(e,t=null){var n=new Date,a=document.querySelector(".user-calendar-date"),o=parseInt(a.getAttribute("data-year-from"))||n.getFullYear(),i=parseInt(a.getAttribute("data-month-from"))||n.getMonth(),r=parseInt(a.getAttribute("data-day-from"))||n.getDate(),l=parseInt(a.getAttribute("data-year-to"))||n.getFullYear(),u=parseInt(a.getAttribute("data-month-to"))||n.getMonth(),a=parseInt(a.getAttribute("data-day-to"))||n.getDate(),c=(new Date(o,i,r),new Date(l,u,a),document.querySelector(".view-content"));c.querySelectorAll(".view-root").forEach(e=>{e.classList.contains("view-load")||e.remove()});for(const g in e)if(e[g].isDirectory)for(const f in e[g].child)if(e[g].child[f].isDirectory){var d=e[g].child[f],s=getFileMetadataDate(d.created);if(null!=s.day&&null!=s.month&&null!=s.year){new Date(s.year,s.month,s.day);var m=[];for(const y in e[g].child[f].child){var h=d.child[f].fileFormat;!0===d.child[f].useFile&&"image"===h&&m.push(e[g].child[f].child[y])}m.sort((e,t)=>e.name.localeCompare(t.name)),0<m.length&&(modalContent=createViewImageGroup(m,d,()=>reloadViewContent(moduleName,t)))&&(s="modal-"+generateRandomUUID(),c.appendChild(modalContent),c.lastElementChild.id=s)}}}function initViewContentUniq(e=null){const n=window.location.origin;var t=JSON.parse(JSON.stringify(viewSystem));t.forEach(t=>{t.isDirectory?t.child.forEach(e=>{e.isDirectory||(e.fullPath=`${n}/media/content/${userContentId}/${moduleName}/${t.name}/`+e.name,e.fileFormat=getFileFormat(e.name),e.useFile=!0)}):(t.fullPath=`${n}/media/content/${userContentId}/${moduleName}/`+t.name,t.fileFormat=null,t.useFile=null)}),setupViewContentUniq(t,e)}function setupViewContentUniq(c,d=null){var e=new Date,t=document.querySelector(".user-calendar-date"),n=parseInt(t.getAttribute("data-year-from"))||e.getFullYear(),a=parseInt(t.getAttribute("data-month-from"))||e.getMonth(),o=parseInt(t.getAttribute("data-day-from"))||e.getDate(),i=parseInt(t.getAttribute("data-year-to"))||e.getFullYear(),r=parseInt(t.getAttribute("data-month-to"))||e.getMonth(),t=parseInt(t.getAttribute("data-day-to"))||e.getDate();const s=new Date(n,a,o),m=new Date(i,r,t),h=document.querySelector(".view-content");h.querySelectorAll(".view-root").forEach(e=>{var t,n;!e.classList.contains("view-load")&&(n=e.getAttribute("data-date"),t=e.getAttribute("data-path"),n||(currentPaths.has(t)&&currentPaths.delete(t),e.remove()),(n=new Date(n))<s||n>m)&&(currentPaths.has(t)&&currentPaths.delete(t),e.remove())}),async function(){for(const i in c)if(c[i].isDirectory)for(const r in c[i].child)if(!c[i].child[r].isDirectory){var t=c[i].child[r],n=getFileMetadataDate(t.created),a=t.fileFormat,e=t.useFile,o=t.fullPath;if(null!=n.day&&null!=n.month&&null!=n.year){n=new Date(n.year,n.month,n.day);try{if(n<s||n>m||currentPaths.has(o))continue}catch{if(n<s||n>m)continue}const l="modal-"+generateRandomUUID();if(!0===e){let e;if("video"===a&&d.includes("video"))e=createViewVideoStatic(o,t,()=>{reloadViewContent(moduleName,d),document.querySelector("#"+l)?.remove()});else if("image"===a&&d.includes("image"))e=createViewImage(o,t,()=>{reloadViewContent(moduleName,d),document.querySelector("#"+l)?.remove()});else{if("audio"!==a||!d.includes("audio"))continue;e=createViewAudio(o,t,()=>{reloadViewContent(moduleName,d),document.querySelector("#"+l)?.remove()})}if(e){h.appendChild(e),currentPaths.add(o);n=h.lastElementChild;n.id=l;const u=n.querySelector("video");u&&await new Promise(e=>{u.onloadeddata=()=>{e()}})}}}}}()}function reloadViewContent(e,t=null){fetch("/content-reload/"+e,{method:"GET",headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{200===e.status?(viewSystem=e.user_file_tree,viewSys=JSON.parse(JSON.stringify(viewSystem)),initViewContent(t)):frontendConsoleLogToBackendPrint(e.message)}).catch(e=>{console.error("Error:",e)})}initViewContent(userFileFormats);