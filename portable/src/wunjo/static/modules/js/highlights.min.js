class SendModuleDataHighlights{constructor(e){this.method=e,this.subMethod=e,this.moduleParameters={nameFile:generateUUID(),segmentLength:10,durationLimit:1,highlightDescription:null,isTranscribe:!1,isSoundAnalysis:!1,isCrop:!1,aspectRatio:null},this.sourceFile={nameFile:null,urlFile:null,formatFile:null,fileSizeBytes:null,naturalWidth:null,naturalHeight:null,offsetWidth:null,offsetHeight:null,startTime:null,endTime:null},this.updatableKeys=new Set(["moduleParameters.nameFile","moduleParameters.segmentLength","moduleParameters.durationLimit","moduleParameters.highlightDescription"])}clearSourceFile(){this.sourceFile={nameFile:null,urlFile:null,formatFile:null,fileSizeBytes:null,naturalWidth:null,naturalHeight:null,offsetWidth:null,offsetHeight:null,startTime:null,endTime:null}}updateData(e){if(this.updatableKeys&&this.updatableKeys instanceof Set){let l=(e,t,a="")=>{for(var n in t){var o=a?a+"."+n:n;this.updatableKeys.has(o)&&n in e?e[n]=t[n]:"object"==typeof t[n]&&null!==t[n]&&n in e&&l(e[n],t[n],o)}};l(this,e)}else console.warn("updateData: updatableKeys not defined, update cancelled.")}}let callbacks={fetchSendModuleDataCallback:fetchModalHighlightsSubmit,setClearCallback:function(){sendModuleData.clearSourceFile()},toggleModificationCallback:toggleModificationHighlights,setTextareaCallback:setTextareaHighlights,setMetaButtonCallback:setMetaButtonHighlights,setMotionButtonCallback:setMotionButtonHighlights,setParametersButtonCallback:!1,setModuleImgButtonsCallback:!1,setModuleVideoButtonsCallback:setModuleVideoButtons,setModuleAudioButtonsCallback:setModuleAudioButtons,setDefaultSendModuleData:SendModuleDataHighlights},sendModuleData=new SendModuleDataHighlights(moduleName);function setAspectRatio(s=null){var e=document.createElement("div");e.classList.add("w-full","flex","flex-col","gap-3","mb-2","rounded-md","col-start-1","col-span-1","row-start-5","gap-2.5","p-2.5","bg-opacity-30","rounded-md","bg-dark-tags","flex","flex-col","gap-5","overflow-auto","transition-[height_max-height]","pr-2","row-span-3"),(aspectRatioTitleDiv=document.createElement("div")).classList.add("flex","gap-3","items-center","justify-between"),(aspectRatioTitleP=document.createElement("p")).classList.add("font-extra-thick"),aspectRatioTitleP.textContent=getTranslationBabel("Aspect ratio"),aspectRatioTitleDiv.appendChild(aspectRatioTitleP);let r=document.createElement("div");function d(e,t,a=0){var[e,n]=e.split(":").map(Number);let o,l;n<=e?(o=t,l=t/e*n):(l=t,o=t/n*e);t=Math.pow(10,a);return o=Math.round(o*t)/t,l=Math.round(l*t)/t,{width:o,height:l}}r.classList.add("flex","gap-2","flex-wrap");let t=["16:9","9:16","1:1","5:2","5:3","4:5","4:3"],u=null,c=null;return getLimitResolution(moduleName).then(i=>{t.forEach((e,t)=>{let a=d(e,i,0);var n=d(e,20,2);let o=document.createElement("button"),l=(o.textContent=e,o.type="button",o.classList.add("aspect-ratio-btn","rounded-md","flex","items-center","justify-center","transition-colors","font-normal","disabled:cursor-not-allowed","px-4","gap-2","py-2.5","flex-1","!bg-dark-elements-upper","!text-light-primary","hover:bg-dark-elements-hover","text-light-primary","bg-dark-pop-up"),document.createElement("span"));l.classList.add("max-w-5","max-h-5","border-[1.5px]","rounded-sm","shrink-0","transition-[border-color]","border-light-secondary"),l.style.width=n.width+"px",l.style.height=n.height+"px",0===t&&(sendModuleData.moduleParameters.aspectRatio=a.width/a.height,u=o,c=l,o.classList.remove("!bg-dark-elements-upper","!text-light-primary"),o.classList.add("!bg-accent-primary","!text-dark-background"),l.classList.remove("border-light-secondary"),l.classList.add("border-dark-background")),o.onclick=function(){sendModuleData.moduleParameters.aspectRatio=a.width/a.height,u&&(u.classList.add("!bg-dark-elements-upper","!text-light-primary"),u.classList.remove("!bg-accent-primary","!text-dark-background")),c&&(c.classList.add("border-light-secondary"),c.classList.remove("border-dark-background")),o.classList.remove("!bg-dark-elements-upper","!text-light-primary"),o.classList.add("!bg-accent-primary","!text-dark-background"),l.classList.remove("border-light-secondary"),l.classList.add("border-dark-background"),u=o,c=l,s&&"function"==typeof s&&s()},o.appendChild(l),r.appendChild(o)})}).catch(e=>{}),e.appendChild(aspectRatioTitleDiv),e.appendChild(r),e}async function createModalSmartCropSubmit(e){"ontouchstart"in window||navigator.msMaxTouchPoints;var t=document.querySelector(".modal-smart-crop-template").content.cloneNode(!0);let a=t.querySelector(".modal-root");var n=a.querySelector(".modal-parameters"),o=a.querySelector(".crop-submit"),l=document.createElement("div");l.classList.add("text-m-mobile","md:tex-m","text-s"),l.appendChild(setAspectRatio()),n.appendChild(l),["mov","mp4"].includes(sendModuleData.sourceFile.formatFile.toLowerCase())?o.onclick=async function(){await createConnection(async function(){e(),a.remove()})}:(o.classList.add("opacity-40"),o.style.pointerEvents="none",o.disabled=!0),document.body.appendChild(t)}async function createModalHighlightsSubmit(e){"ontouchstart"in window||navigator.msMaxTouchPoints;var t=document.querySelector(".modal-highlights-template").content.cloneNode(!0);let a=t.querySelector(".modal-root");var n=a.querySelector(".visual-submit"),o=a.querySelector(".sound-submit");["mov","mp4"].includes(sendModuleData.sourceFile.formatFile.toLowerCase())?n.onclick=async function(){sendModuleData.moduleParameters.isSoundAnalysis=!1,e(),a.remove()}:(n.classList.add("opacity-40"),n.style.pointerEvents="none",n.disabled=!0),o.onclick=async function(){await createConnection(async function(){sendModuleData.moduleParameters.isSoundAnalysis=!0,e(),a.remove()})},document.body.appendChild(t)}async function fetchModalHighlightsSubmit(){var e=sendModuleData.sourceFile.formatFile&&["mp4"].includes(sendModuleData.sourceFile.formatFile.toLowerCase())?{tmpFileName:tmpFileNameVideo=generateVideoFilename(),validMessage:""}:(console.log("The format file is neither a video format."),{tmpFileName:!1,validMessage:getTranslationBabel("Yikes! Where is video? Attach its and continue.")}),t=e.validMessage;return e.tmpFileName&&sendModuleData.sourceFile.urlFile?(sendModuleData.sourceFile.nameFile=sendModuleData.sourceFile.urlFile.split("/").pop(),sendModuleData.moduleParameters.highlightDescription=await translateText(sendModuleData.moduleParameters.highlightDescription,"en","auto"),sendModuleData.moduleParameters.isCrop?await createModalSmartCropSubmit(a):await createModalHighlightsSubmit(a),{statusBool:!0,validMessage:t}):{statusBool:!1,validMessage:t};async function a(){console.log(JSON.stringify(sendModuleData,null,4)),await postModuleTaskEvent(sendModuleData),sendModuleData.moduleParameters.nameFile=generateUUID()}}async function fetchModalCutSubmit(e){let t={method:moduleName,subMethod:moduleCutName,sourceFile:{nameFile:sendModuleData.sourceFile.nameFile,urlFile:sendModuleData.sourceFile.urlFile,formatFile:sendModuleData.sourceFile.formatFile},moduleParameters:{nameFile:sendModuleData.moduleParameters.nameFile,segments:e}};var e=(()=>{let e=null;if(t.sourceFile.formatFile&&["mp4"].includes(t.sourceFile.formatFile.toLowerCase()))e=generateVideoFilename();else{if(!t.sourceFile.formatFile||!["wav","mp3"].includes(t.sourceFile.formatFile.toLowerCase()))return console.log("The format file is neither a video or audio format."),{tmpFileName:null,validMessage:getTranslationBabel("Yikes! Where is video or audio? Attach its and continue.")};e=generateAudioFilename()}return{tmpFileName:e,validMessage:""}})(),a=e.tmpFileName,e=e.validMessage;return a&&t.sourceFile.urlFile?(t.sourceFile.nameFile=t.sourceFile.urlFile.split("/").pop(),console.log(JSON.stringify(t,null,4)),await postModuleTaskEvent(t),await!(t.moduleParameters.nameFile=generateUUID()),{statusBool:!0,validMessage:e}):{statusBool:!1,validMessage:e}}function toggleModificationHighlights(e){var t=e.querySelector(".footer-toggle-icon"),a=e.querySelector(".footer-toggle-name"),n=e.querySelector(".footer-toggle-title"),e=e.querySelector(".sr-only");t.innerHTML='<svg width="20px" height="20px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.9984 2H2V4.9984H4.9984V2Z" stroke="white" stroke-width="1" stroke-miterlimit="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M4.99854 3.50098H18.9987" stroke="white" stroke-width="1" stroke-miterlimit="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M3.5 4.99854V19.0005" stroke="white" stroke-width="1" stroke-miterlimit="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M20.4978 5V19.002" stroke="white" stroke-width="1" stroke-miterlimit="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M4.99854 20.501H18.9987" stroke="white" stroke-width="1" stroke-miterlimit="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M4.9984 19H2V21.9984H4.9984V19Z" stroke="white" stroke-width="1" stroke-miterlimit="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M21.9974 2.00195H18.999V5.00035H21.9974V2.00195Z" stroke="white" stroke-width="1" stroke-miterlimit="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M21.9974 19.002H18.999V22.0004H21.9974V19.002Z" stroke="white" stroke-width="1" stroke-miterlimit="1.5" stroke-linecap="round" stroke-linejoin="round"/><path fill-rule="evenodd" clip-rule="evenodd" d="M10.9966 15.002L7.99658 8.00195L14.9966 11.002L11.9986 12.0009L10.9966 15.002Z" stroke="white" stroke-width="1" stroke-miterlimit="1.5" stroke-linecap="round" stroke-linejoin="round"/><path fill-rule="evenodd" clip-rule="evenodd" d="M11.999 12.002L14.997 15.002L11.999 12.002Z" stroke="white" stroke-width="1" stroke-miterlimit="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>',a.textContent=getTranslationBabel("Smart crop"),n.textContent=getTranslationBabel("Enable smart crop to create videos for YouTube, Tik Tok, Instagram, etc. Allows you to change any aspect ratio for your video using artificial intelligence and focus on interest objects and speakers."),e.onchange=function(){toggleLogical(this),sendModuleData.moduleParameters.isCrop=!sendModuleData.moduleParameters.isCrop}}function setTextareaHighlights(e=0){var t=document.createElement("div");t.classList.add("w-full","relative","flex","items-center","gap-2","bg-dark-elements","rounded-[.625rem]","pl-4","pr-2");let a=document.createElement("textarea");a.classList.add("bg-transparent","my-1","appearance-none","font-mono","outline-none","w-full","resize-none","placeholder:text-light-secondary","flex-1","h-5","disabled:cursor-not-allowed","lg:text-regular","text-regular-mobile"),a.rows=1,a.placeholder=getTranslationBabel("(Optional) Describe how to edit a video"),a.maxlength=3e3;var n=document.createElement("div"),o=(n.classList.add("max-md:hidden","flex","gap-3","items-center"),document.createElement("button"));o.classList.add("flex","gap-2","items-center","relative","opacity-60","hover:opacity-100","transition-opacity","py-1.5","px-0","confetti-button"),o.title=getTranslationBabel("Inspire me"),o.type="button",o.innerHTML='<svg fill="white" width="30px" height="30px" viewBox="0 0 256 256" xmlns="http://www.w3.org/2000/svg"><g fill-rule="evenodd"> <path d="M47.895 88.097c.001-4.416 3.064-9.837 6.854-12.117l66.257-39.858c3.785-2.277 9.915-2.277 13.707.008l66.28 39.934c3.786 2.28 6.853 7.703 6.852 12.138l-.028 79.603c-.001 4.423-3.069 9.865-6.848 12.154l-66.4 40.205c-3.781 2.29-9.903 2.289-13.69-.01l-66.167-40.185c-3.78-2.295-6.842-7.733-6.84-12.151l.023-79.72zm13.936-6.474l65.834 36.759 62.766-36.278-62.872-36.918L61.83 81.623zM57.585 93.52c0 1.628-1.065 71.86-1.065 71.86-.034 2.206 1.467 4.917 3.367 6.064l61.612 37.182.567-77.413s-64.48-39.322-64.48-37.693zm76.107 114.938l60.912-38.66c2.332-1.48 4.223-4.915 4.223-7.679V93.125l-65.135 37.513v77.82z"></path><path d="M77.76 132.287c-4.782 2.762-11.122.735-14.16-4.526-3.037-5.261-1.622-11.765 3.16-14.526 4.783-2.762 11.123-.735 14.16 4.526 3.038 5.261 1.623 11.765-3.16 14.526zm32 21c-4.782 2.762-11.122.735-14.16-4.526-3.037-5.261-1.622-11.765 3.16-14.526 4.783-2.762 11.123-.735 14.16 4.526 3.038 5.261 1.623 11.765-3.16 14.526zm-32 16c-4.782 2.762-11.122.735-14.16-4.526-3.037-5.261-1.622-11.765 3.16-14.526 4.783-2.762 11.123-.735 14.16 4.526 3.038 5.261 1.623 11.765-3.16 14.526zm32 21c-4.782 2.762-11.122.735-14.16-4.526-3.037-5.261-1.622-11.765 3.16-14.526 4.783-2.762 11.123-.735 14.16 4.526 3.038 5.261 1.623 11.765-3.16 14.526zm78.238-78.052c-4.783-2.762-11.122-.735-14.16 4.526-3.037 5.261-1.623 11.765 3.16 14.526 4.783 2.762 11.123.735 14.16-4.526 3.038-5.261 1.623-11.765-3.16-14.526zm-16.238 29c-4.782-2.762-11.122-.735-14.16 4.526-3.037 5.261-1.622 11.765 3.16 14.526 4.783 2.762 11.123.735 14.16-4.526 3.038-5.261 1.623-11.765-3.16-14.526zm-17 28c-4.782-2.762-11.122-.735-14.16 4.526-3.037 5.261-1.622 11.765 3.16 14.526 4.783 2.762 11.123.735 14.16-4.526 3.038-5.261 1.623-11.765-3.16-14.526zM128.5 69c-6.351 0-11.5 4.925-11.5 11s5.149 11 11.5 11S140 86.075 140 80s-5.149-11-11.5-11z"></path></g></svg>';let l=sendModuleData.moduleParameters.highlightDescription;return Object.defineProperty(sendModuleData.moduleParameters,"highlightDescription",{get(){return l},set(e){l!==e&&(l=e,a.value=e)}}),a.addEventListener("input",function(){sendModuleData.moduleParameters.highlightDescription=a.value}),o.addEventListener("click",function(){a.value=getRandomPrompt(),sendModuleData.moduleParameters.highlightDescription=a.value}),n.appendChild(o),t.appendChild(a),t.appendChild(n),t}function getRandomPrompt(){var e=[getTranslationBabel("You are a highlight editor. List archetypal dramatic moments that would make compelling highlights if they appear in the video. Each moment should be specific enough to be recognizable but generic enough to potentially exist in other videos of this type."),getTranslationBabel("You are a helpful visual-language assistant that can understand videos and edit. You are tasked helping the user to create highlight reels for videos. Highlights should be rare and important events in the video in question.")];return e[Math.floor(Math.random()*e.length)]}function setMetaButtonHighlights(){var e=document.querySelector(".footer-parameters").querySelector("div"),t=(e.innerHTML="",sendModuleData.moduleParameters.nameFile),t=createGeneralTextInput({label:getTranslationBabel("Filename"),defaultValue:t,disableStatus:!1,onChange:e=>{var t=event.target.value;/^[a-zA-Z0-9-]*$/.test(t)||(event.target.value=t.slice(0,-1)),sendModuleData.moduleParameters.nameFile=e}}).wrapper;let n=createGeneralTextInput({label:getTranslationBabel("Resized to"),defaultValue:"1280x720",disableStatus:!0}).wrapper;getLimitResolution(moduleName).then(e=>{var t=sendModuleData.sourceFile.naturalWidth,a=sendModuleData.sourceFile.naturalHeight,e=setLimitResolution(e,t,a);n.querySelector("input").value=e.newWidth+"x"+e.newHeight}).catch(e=>{}),e.append(t,n)}function setMotionButtonHighlights(){var e=document.querySelector(".footer-parameters").querySelector("div"),t=(e.innerHTML="",sendModuleData.moduleParameters.segmentLength),a=getTranslationBabel("If you want to slow things down a bit, choose a longer segment length. That'll give you fewer, longer chunks, which means less rush, more moments to shine, but a bit less of that fast-paced flow. It's all about balancing energy and detail, so pick what suits your video vibe best!"),n=getTranslationBabel("Alright, time to set the pace! The segment length is like choosing the perfect stride for your video’s rhythm. Go with a shorter segment length, and you'll get quick, snappy video chunks — more dynamic, more action, keeping the energy high."),a=createGeneralSliderInput({label:getTranslationBabel("Segment length"),min:5,max:60,step:1,titleMax:a,titleMin:n,defaultValue:t,onChange:e=>{sendModuleData.moduleParameters.segmentLength=e}}).wrapper,n=sendModuleData.moduleParameters.durationLimit,t=createGeneralSliderInput({label:getTranslationBabel("Maximum duration (min)"),min:1,max:120,step:1,titleMax:null,titleMin:null,defaultValue:n,onChange:e=>{sendModuleData.moduleParameters.durationLimit=e}}).wrapper;e.append(a,t)}function setModuleAudioButtons(){var e=[],t=setButtonAssistantHighlights(),a=setButtonSmartCut();return e.push(t,a),e}function setModuleVideoButtons(){var e=[],t=setButtonAssistantHighlights(),a=setButtonSmartCut();return e.push(t,a),e}function setButtonAssistantHighlights(){var e=document.createElement("div"),t=(e.classList.add("relative","group"),document.createElement("div")),a=(t.classList.add("hidden","absolute","p-2","group-hover:flex","items-center","gap-3","bottom-full","left-1/2","-translate-x-1/2","-translate-y-3.5","bg-dark-elements-hover","rounded-md","w-[300px]"),document.createElement("img")),n=(a.classList.add("w-20","h-20","rounded-md"),a.src="/static/modules/thumbnail/assistant.png",a.alt="Assistant content",a.width=256,a.height=256,document.createElement("span")),o=(n.classList.add("text-m-mobile","lg:text-m"),n.style="display: inline-block; vertical-align: top; text-decoration: inherit; text-wrap: balance;",n.textContent=getTranslationBabel("Ready to transcribe or to analyze the content and answer all the questions!"),document.createElement("div")),l=(o.classList.add("module-button-div","relative","flex","gap-2","items-center","rounded-md","bg-light-emphasis"),o.style.stroke="white",document.createElement("button")),i=(l.classList.add("relative","flex","gap-2","items-baseline","group","py-1.5","pl-2","whitespace-nowrap","font-extra-thick","pr-2"),l.type="button",l.innerHTML='<i class="fa-solid fa-square-root-variable transition-[stroke,opacity] opacity-60 group-hover:opacity-100"></i>',document.createElement("span"));return i.textContent=getTranslationBabel("Assistant"),l.onclick=function(){document.querySelector(".footer-preview")&&createModalAssistantHighlights(sendModuleData.sourceFile.urlFile)},l.appendChild(i),t.appendChild(a),t.appendChild(n),o.appendChild(l),e.appendChild(t),e.appendChild(o),e}function setButtonSmartCut(){var e=document.createElement("div"),t=(e.classList.add("relative","group"),document.createElement("div")),a=(t.classList.add("hidden","absolute","p-2","group-hover:flex","items-center","gap-3","bottom-full","left-1/2","-translate-x-1/2","-translate-y-3.5","bg-dark-elements-hover","rounded-md","w-[300px]"),document.createElement("img")),n=(a.classList.add("w-20","h-20","rounded-md"),a.src="/static/modules/thumbnail/cut.png",a.alt="Assistant content",a.width=256,a.height=256,document.createElement("span")),o=(n.classList.add("text-m-mobile","lg:text-m"),n.style="display: inline-block; vertical-align: top; text-decoration: inherit; text-wrap: balance;",n.textContent=getTranslationBabel("Once the text appears, highlight words or phrases to select video or audio segments to edit a media file."),document.createElement("div")),l=(o.classList.add("module-button-div","relative","flex","gap-2","items-center","rounded-md","bg-light-emphasis"),o.style.stroke="white",document.createElement("button")),i=(l.classList.add("relative","flex","gap-2","items-baseline","group","py-1.5","pl-2","whitespace-nowrap","font-extra-thick","pr-2"),l.type="button",l.innerHTML='<i class="fa-solid fa-scissors transition-[stroke,opacity] opacity-60 group-hover:opacity-100"></i>',document.createElement("span"));return i.textContent=getTranslationBabel("Cut"),l.onclick=function(){document.querySelector(".footer-preview")&&createModalSmartCut(sendModuleData.sourceFile.urlFile)},l.appendChild(i),t.appendChild(a),t.appendChild(n),o.appendChild(l),e.appendChild(t),e.appendChild(o),e}async function createModalSmartCut(e){var t=document.querySelector(".modal-smart-cut-template").content.cloneNode(!0);let a=t.querySelector(".modal-root"),i=a.querySelector(".modal-smart-cut"),n=a.querySelector(".modal-smart-sequence"),o=a.querySelector(".back-smart-cut"),l=a.querySelector(".submit-smart-cut"),s=a.querySelector(".continue-smart-cut"),r={container:a.querySelector(".js-timeline-controls"),controls:{start:{back:a.querySelector(".js-timeline-start-back"),input:a.querySelector(".js-timeline-start-input"),forward:a.querySelector(".js-timeline-start-forward")},end:{back:a.querySelector(".js-timeline-end-back"),input:a.querySelector(".js-timeline-end-input"),forward:a.querySelector(".js-timeline-end-forward")}},deleteButton:a.querySelector(".js-timeline-delete")};var d={image:["png","jpeg","jpg"],video:["mov","mp4"],audio:["wav","mp3"]};let u=Math.floor(100*Math.random())+1;var c,m=null,h=null,p=[];for(c of t.querySelectorAll("template_element")){var g=Array.from(c.classList).map(e=>"."+e).join("");if(g){g=document.querySelector(g);if(g){var f=g.content.cloneNode(!0);if("video-handler"===g.dataset.component&&d.video.includes(sendModuleData.sourceFile.formatFile))m=(f=new SegmentVideoHandler({src:e,container:f,data:sendModuleData.sourceFile,isWatch:!0,isLoaderId:u,loadOnInit:!0})).loaderContainer;else{if("audio-handler"!==g.dataset.component||!d.audio.includes(sendModuleData.sourceFile.formatFile))continue;m=(f=new SegmentAudioHandler({src:e,container:f,data:sendModuleData.sourceFile,maxDuration:maxDurationToShow,isLoaderId:u})).loaderContainer,m.classList.remove("hidden")}h=f,c.replaceWith(f.container)}else console.warn(`Template with class "${templateClass}" not found`)}}function v(t=!0){Object.values(r.controls).flatMap(e=>Object.values(e)).concat(r.deleteButton).forEach(e=>{(e instanceof HTMLButtonElement||e instanceof HTMLInputElement)&&(e.disabled=t)})}function b(){var e=[...n.querySelectorAll("span")].map((e,t)=>(e.dataset.index=t,{start:parseFloat(e.dataset.start),end:parseFloat(e.dataset.end),text:e.textContent}));h.segments=e}function y(e){let a=e.target,n=(r.controls.start.input.value=a.dataset.start,r.controls.end.input.value=a.dataset.end,Math.min(Number(r.controls.start.input.step),Number(r.controls.end.input.step)));var o=null;r.controls.start.back.onclick=function(){var e=Number(r.controls.start.input.value);o=Math.max(0,e-n).toFixed(2),r.controls.start.input.value=o,a.dataset.start=o,M(a)},r.controls.start.input.oninput=function(){var e=Number(r.controls.end.input.value);o=Math.max(0,Math.min(this.value,e-.3)).toFixed(2),r.controls.start.input.value=o,a.dataset.start=o,M(a)},r.controls.start.forward.onclick=function(){var e=Number(r.controls.start.input.value),t=Number(r.controls.end.input.value);o=Math.min(e+n,t-.3).toFixed(2),r.controls.start.input.value=o,a.dataset.start=o,M(a)},r.controls.end.back.onclick=function(){var e=Number(r.controls.end.input.value),t=Number(r.controls.start.input.value);o=Math.max(t+.3,e-n).toFixed(2),r.controls.end.input.value=o,a.dataset.end=o,M(a)},r.controls.end.input.oninput=function(){var e=Number(r.controls.start.input.value);o=Math.max(e+.3,Math.min(this.value,h.duration)).toFixed(2),r.controls.end.input.value=o,a.dataset.end=o,M(a)},r.controls.end.forward.onclick=function(){var e=Number(r.controls.end.input.value);o=Math.min(h.duration,e+n).toFixed(2),r.controls.end.input.value=o,a.dataset.end=o,M(a)},v(!(r.deleteButton.onclick=function(){a.remove(),b(),v(!0),0===h.segments.length&&(l.disabled=!0)}))}function M(a){h.segments[a.dataset.index]={start:a.dataset.start,end:a.dataset.end,text:a.textContent},b(),[e=null]=[a.dataset.start],e&&(h instanceof SegmentVideoHandler?h.video.currentTime=e:h instanceof SegmentAudioHandler&&(h.audio.currentTime=e));var e=p.filter(e=>{var t=parseFloat(e.dataset.start),e=parseFloat(e.dataset.end);return t>=a.dataset.start&&e<=a.dataset.end});e.length&&(a.textContent=e.map(e=>e.textContent).join(" "))}s.onclick=async function(){if(h.segments&&0<h.segments.length){n.innerHTML=h.segments.map((e,t)=>`<span draggable="true" data-index="${t}" data-start="${e.start}" data-end="${e.end}" class="ml-1 mr-1 rounded-lg relative px-2 cursor-pointer bg-accent-primary text-black">${e.text}</span>`).join(" ");let a=null;n.querySelectorAll("span").forEach((t,e)=>{t.addEventListener("click",y),0===e&&t.click(),t.addEventListener("dragstart",e=>{a=t,e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/html",t.outerHTML),t.classList.add("opacity-50")}),t.addEventListener("dragover",e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"}),t.addEventListener("drop",e=>{e.stopPropagation(),a!==t&&([...(e=t.parentNode).children].indexOf(a)<[...e.children].indexOf(t)?e.insertBefore(a,t.nextSibling):e.insertBefore(a,t),b())}),t.addEventListener("dragend",()=>{t.classList.remove("opacity-50"),a=null})}),i.classList.add("hidden"),n.classList.remove("hidden"),r.container.classList.remove("hidden"),o.disabled=!1,l.disabled=!1,l.classList.remove("hidden"),s.classList.add("hidden")}},l.onclick=async function(){0<h.segments.length&&(fetchModalCutSubmit(h.segments),a.remove())},o.onclick=function(){this.disabled=!0,i.classList.remove("hidden"),n.classList.add("hidden"),r.container.classList.add("hidden"),l.classList.add("hidden"),s.classList.remove("hidden"),p.forEach(e=>e.classList.remove("highlight")),h.segments.forEach(a=>{var e=p.filter(e=>{var t=parseFloat(e.dataset.start),e=parseFloat(e.dataset.end);return t>=a.start&&e<=a.end});e.length&&(a.text=e.map(e=>e.textContent).join(" "),e.forEach(e=>e.classList.add("highlight")))})},document.body.appendChild(t),loaderModalBusy(getTranslationBabel("Processing... A file timestamps is on its way."),u),await fetchSendModuleDataAssistant(u,"",!0,function(e=null,t=!1){if(e&&0<e.length&&!1===t){if(!Array.isArray(e))return void loaderModalError(getTranslationBabel("No speech found in a media."),u);s.disabled=t,i.innerHTML=e.filter(e=>.2<e.confidence).map((e,t)=>`<span data-index="${t}" data-start="${e.start}" data-end="${e.end}" class="word">${e.text}</span>`).join(" "),p=[...i.querySelectorAll(".word")],i.addEventListener("mouseup",()=>{var e=window.getSelection();if(e.rangeCount){let t=e.getRangeAt(0);p.filter(e=>t.intersectsNode(e)).forEach(e=>{e.classList.toggle("highlight")});var a=[...i.querySelectorAll(".word.highlight")];if(h instanceof SegmentVideoHandler||h instanceof SegmentAudioHandler){var n=[];let t=[];for(let e=0;e<a.length;e++){var o=a[e],l=a[e-1];l&&1<parseFloat(o.dataset.index)-parseFloat(l.dataset.index)?(t.length&&n.push({text:Array.from(t).map(e=>e.textContent).join(" "),start:parseFloat(t[0].dataset.start),end:parseFloat(t[t.length-1].dataset.end)}),t=[o]):t.push(o)}t.length&&n.push({text:Array.from(t).map(e=>e.textContent).join(" "),start:parseFloat(t[0].dataset.start),end:parseFloat(t[t.length-1].dataset.end)}),h.setSegments(n)}}})}})}async function createModalAssistantHighlights(e){var t=document.querySelector(".modal-assistant-highlights-template").content.cloneNode(!0),a=t.querySelector(".modal-root");let n=a.querySelector(".modal-input-question"),o=a.querySelector(".modal-output"),l=a.querySelector(".transcribe-button"),i=a.querySelector(".submit-question");var s={image:["png","jpeg","jpg"],video:["mov","mp4"],audio:["wav","mp3"]};let r=Math.floor(100*Math.random())+1;var d,u=null,c=null;for(d of t.querySelectorAll("template_element")){var m=Array.from(d.classList).map(e=>"."+e).join("");if(m){m=document.querySelector(m);if(m){var h=m.content.cloneNode(!0);if("video-handler"===m.dataset.component&&s.video.includes(sendModuleData.sourceFile.formatFile))h=new VideoHandler({src:e,container:h,data:sendModuleData.sourceFile,isWatch:!0,isLoaderId:r}),u=h.loaderContainer;else{if("audio-handler"!==m.dataset.component||!s.audio.includes(sendModuleData.sourceFile.formatFile))continue;h=new AudioHandler({src:e,container:h,data:sendModuleData.sourceFile,maxDuration:maxDurationToShow,isLoaderId:r}),u=h.loaderContainer,c=h.audioContainer}d.replaceWith(h.container)}else console.warn(`Template with class "${templateClass}" not found`)}}function p(e=null,t=!1){l.disabled=t,i.disabled=t,o.value=e,c&&c.classList.remove("hidden")}s.audio.includes(sendModuleData.sourceFile.formatFile)&&(sendModuleData.moduleParameters.isSoundAnalysis=!0),l.onclick=async()=>{sendModuleData.moduleParameters.isTranscribe=!0,u&&u.classList.remove("hidden"),c&&c.classList.add("hidden"),await fetchSendModuleDataAssistant(r,n.value,!1,p),l.disabled=!0,i.disabled=!0},i.onclick=async()=>{await createModalHighlightsSubmit(async function(){n.value&&""!==n.value.trim()&&(sendModuleData.moduleParameters.isTranscribe=!1,u&&u.classList.remove("hidden"),c&&c.classList.add("hidden"),await fetchSendModuleDataAssistant(r,n.value,!1,p),l.disabled=!0,i.disabled=!0)})},document.body.appendChild(t)}async function fetchSendModuleDataAssistant(a,t,n=!1,o=null){let l=["wav","mp3"].includes(sendModuleData.sourceFile.formatFile);await(async()=>{t=await translateText(t,"en","auto");let e={method:moduleName,filename:sendModuleData.sourceFile.nameFile,prompt:t,isTranscribe:sendModuleData.moduleParameters.isTranscribe,isTranscribeWords:n,startTime:sendModuleData.sourceFile.startTime,endTime:sendModuleData.sourceFile.endTime,isSoundAnalysis:sendModuleData.moduleParameters.isSoundAnalysis};console.log(JSON.stringify(e,null,4)),await fetch("/submit-cpu-task",{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(t=>{if(200===t.status){let e=t.id;setTimeout(()=>{(async(a,e,n=null)=>{const o=setInterval(async()=>{await fetch(`/query-cpu-task/${e}`,{method:"GET",headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{if(e.status===200){clearInterval(o);if(!e.response){loaderModalWarn(getTranslationBabel("Oops! Something went wrong. Please click submit again after some time. Tap on the screen to view details."),a,l);if(n&&typeof n==="function")n(null,true);return}const t=e.response.text;if(n&&typeof n==="function")n(t);loaderModalHidden(a,l)}else if(e.status===300){loaderModalWarn(e.response.message,a,l);if(n&&typeof n==="function")n(null,true,true)}else if(e.status===404){loaderModalWarn(e.response.message,a,l);if(n&&typeof n==="function")n(null,true,true)}else loaderModalBusy(`${e.progress_message} ${e.progress}%`,a,l)}).catch(e=>{clearInterval(o);loaderModalError(getTranslationBabel("Oops! An unexpected error occurred. Tap on the screen to view details."),a,l);if(n&&typeof n==="function")n(null,true,true)})},3e3)})(a,e,o)},1e3)}else loaderModalWarn("Something wrong..."+t.message,a,l)}).catch(e=>{loaderModalError("Something wrong...During create task. Tap on the screen to view details.",a,l)})})()}function setLiteSetting(){let e=getTranslationBabel("highlights");var t=document.querySelector("#settings");t.href="",t.onclick=async function(){event.preventDefault(),createModalLiteSetting(e,"HIGHLIGHTS")}}setLiteSetting(),createFooterFile(callbacks,["video","audio","text"]);