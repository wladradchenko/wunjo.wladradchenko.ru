class SendModuleDataLipSync{constructor(e){this.method=e,this.subMethod=e,this.moduleParameters={nameFile:generateUUID(),cropField:[],overlayAudio:!1,useGfpgan:!1,useSmooth:!1,useDiffuser:!1},this.sourceFile={nameFile:null,urlFile:null,formatFile:null,fileSizeBytes:null,naturalWidth:null,naturalHeight:null,offsetWidth:null,offsetHeight:null,startTime:null,endTime:null},this.audioFile={nameFile:null,urlFile:null,formatFile:null,fileSizeBytes:null,startTime:null,endTime:null},this.updatableKeys=new Set(["moduleParameters.nameFile","moduleParameters.overlayAudio","moduleParameters.useGfpgan","moduleParameters.useSmooth","moduleParameters.useDiffuser"])}clearSourceFile(){this.sourceFile={nameFile:null,urlFile:null,formatFile:null,fileSizeBytes:null,naturalWidth:null,naturalHeight:null,offsetWidth:null,offsetHeight:null,startTime:null,endTime:null},this.audioFile={nameFile:null,urlFile:null,formatFile:null,fileSizeBytes:null,startTime:null,endTime:null}}updateData(e){if(this.updatableKeys&&this.updatableKeys instanceof Set){const n=(e,t,a="")=>{for(const o in t){var l=a?a+"."+o:o;this.updatableKeys.has(l)&&o in e?e[o]=t[o]:"object"==typeof t[o]&&null!==t[o]&&o in e&&n(e[o],t[o],l)}};n(this,e)}else console.warn("updateData: updatableKeys not defined, update cancelled.")}}const callbacks={fetchSendModuleDataCallback:fetchModalLipSyncSubmit,setClearCallback:function(){sendModuleData.clearSourceFile()},toggleModificationCallback:null,setMetaButtonCallback:setMetaButtonLipSync,setMotionButtonCallback:-1!==navigator.platform.indexOf("Linux")?setMotionButtonLipSync:null,setParametersButtonCallback:setParametersButtonLipSync,setModuleImgButtonsCallback:setModuleImgButtons,setModuleVideoButtonsCallback:setModuleVideoButtons,setDefaultSendModuleData:SendModuleDataLipSync};let sendModuleData=new SendModuleDataLipSync(moduleName);async function fetchSendModuleDataLipSync(){var e=function(){let e=!1,t=!1;if(!Array.isArray(sendModuleData.moduleParameters.cropField))return console.log("Crop field is not array"),{tmpFileNameSrc:e,tmpFileNameAudio:t,validMessage:getTranslationBabel("Wow! Seems like you didn’t pick a face in your content witch need to animate. Click on the «Find face» button and set box on person face, please!")};if(0===sendModuleData.moduleParameters.cropField.length)return console.log("Crop field of source file is empty"),{tmpFileNameSrc:e,tmpFileNameAudio:t,validMessage:getTranslationBabel("Wow! Seems like you didn’t pick a face in your content witch need to animate. Click on the «Find face» button and set box on person face, please!")};if(""===sendModuleData.moduleParameters.nameFile.trim()&&(sendModuleData.moduleParameters.nameFile=generateUUID()),"number"!=typeof sendModuleData.sourceFile.offsetWidth||isNaN(sendModuleData.sourceFile.offsetWidth))return console.log("Offset width is not a number or is empty"),{tmpFileNameSrc:e,tmpFileNameAudio:t,validMessage:getTranslationBabel("Uh-oh! The width looks wonky. Double-check it’s a number and not empty. Maybe click on «Select object» or load another file.")};if("number"!=typeof sendModuleData.sourceFile.offsetHeight||isNaN(sendModuleData.sourceFile.offsetHeight))return console.log("Offset height is not a number or is empty"),{tmpFileNameSrc:e,tmpFileNameAudio:t,validMessage:getTranslationBabel("Hmm... The height seems fishy. Verify it’s a number and not empty. Check it’s a number and not empty. Maybe click on «Select object» or load another file.")};if(["jpg","jpeg","png","gif","bmp"].includes(sendModuleData.sourceFile.formatFile.toLowerCase()))e=generateImageFilename();else{if(!["mp4","avi","mov","wmv","mkv"].includes(sendModuleData.sourceFile.formatFile.toLowerCase()))return console.log("The format file is neither an image nor a video format."),{tmpFileNameSrc:e,tmpFileNameAudio:t,validMessage:getTranslationBabel("Yikes! Looks like an alien format. Stick to images or videos for now.")};e=generateVideoFilename()}return sendModuleData.audioFile.formatFile&&["wav","mp3"].includes(sendModuleData.audioFile.formatFile.toLowerCase())?(t=generateAudioFilename(),{tmpFileNameSrc:e,tmpFileNameAudio:t,validMessage:""}):(console.log("The format file is neither an audio format."),{tmpFileNameSrc:e,tmpFileNameAudio:t,validMessage:getTranslationBabel("Yikes! Looks like an alien format. Stick to audio speech for now.")})}(),t=e.tmpFileNameSrc,a=e.tmpFileNameAudio,e=e.validMessage;if(!t||!a)return{statusBool:!1,validMessage:e};if(sendModuleData.audioFile.nameFile=a,!sendModuleData.sourceFile.urlFile)return{statusBool:!1,validMessage:e};sendModuleData.sourceFile.nameFile=sendModuleData.sourceFile.urlFile.split("/").pop();let l=sendModuleData.audioFile.urlFile;return(l="string"==typeof l?await urlToBlob(l):l)?(console.log("download file"),await uploadChunkFile(l,a),sendModuleData.audioFile.urlFile=null,console.log(JSON.stringify(sendModuleData,null,4)),await postModuleTaskEvent(sendModuleData),sendModuleData.moduleParameters.nameFile=generateUUID(),sendModuleData.audioFile.urlFile=URL.createObjectURL(l),{statusBool:!0,validMessage:e}):{statusBool:!1,validMessage:e}}function setMetaButtonLipSync(){var e=document.querySelector(".footer-parameters").querySelector("div"),t=(e.innerHTML="",sendModuleData.moduleParameters.nameFile),t=createGeneralTextInput({label:getTranslationBabel("Filename"),defaultValue:t,disableStatus:!1,onChange:e=>{var t=event.target.value;/^[a-zA-Z0-9-]*$/.test(t)||(event.target.value=t.slice(0,-1)),sendModuleData.moduleParameters.nameFile=e}})["wrapper"];const l=createGeneralTextInput({label:getTranslationBabel("Resized to"),defaultValue:"1280x720",disableStatus:!0})["wrapper"];getLimitResolution(moduleName).then(e=>{var t=sendModuleData.sourceFile.naturalWidth,a=sendModuleData.sourceFile.naturalHeight,e=setLimitResolution(e,t,a);l.querySelector("input").value=e.newWidth+"x"+e.newHeight}).catch(e=>{}),e.append(t,l)}function setMotionButtonLipSync(){var e=document.querySelector(".footer-parameters").querySelector("div"),t=(e.innerHTML="",sendModuleData.moduleParameters.overlayAudio),t=createGeneralRadioButton({label:getTranslationBabel("Overlay audio"),defaultValue:t,onChange:e=>{sendModuleData.moduleParameters.overlayAudio=e}})["wrapper"];e.append(t)}function setParametersButtonLipSync(){var e=document.querySelector(".footer-parameters").querySelector("div"),t=(e.innerHTML="",sendModuleData.moduleParameters.useSmooth),t=createGeneralRadioButton({label:getTranslationBabel("Smooth defects"),defaultValue:t,onChange:e=>{sendModuleData.moduleParameters.useSmooth=e}})["wrapper"],a=sendModuleData.moduleParameters.useGfpgan,a=createGeneralRadioButton({label:getTranslationBabel("Enhancement"),defaultValue:a,onChange:e=>{sendModuleData.moduleParameters.useGfpgan=e}})["wrapper"];e.append(t,a)}function setModuleImgButtons(){var e=[],t=setButtonSelectSourceLipSync(),a=setButtonSelectAudioLipSync(),l=setButtonSelectAnalysis();return e.push(t,a,l),e}function setModuleVideoButtons(){var e=[],t=setButtonSelectSourceLipSync(),a=setButtonSelectAudioLipSync(),l=setButtonSelectAnalysis();return e.push(t,a,l),e}function setButtonSelectSourceLipSync(){var e=document.createElement("div"),t=(e.classList.add("relative","group"),document.createElement("div")),a=(t.classList.add("hidden","absolute","p-2","group-hover:flex","items-center","gap-3","bottom-full","left-1/2","-translate-x-1/2","-translate-y-3.5","bg-dark-elements-hover","rounded-md","w-[300px]"),document.createElement("img")),l=(a.classList.add("w-20","h-20","rounded-md"),a.src="/static/modules/thumbnail/find_face.png",a.alt="Source face area select explain",a.width=256,a.height=256,document.createElement("span")),o=(l.classList.add("text-m-mobile","lg:text-m"),l.style="display: inline-block; vertical-align: top; text-decoration: inherit; text-wrap: balance;",l.textContent=getTranslationBabel("Pick face to animate. Select start and end for seamless changes. No cutting, just smooth transitions. Easy!"),document.createElement("div")),n=(o.classList.add("module-button-div","relative","flex","gap-2","items-center","rounded-md","bg-light-emphasis"),o.style.stroke="white",document.createElement("button")),i=(n.classList.add("stroke-danger-primary","text-danger-primary","relative","flex","gap-2","items-center","group","py-1.5","pl-2","whitespace-nowrap","font-extra-thick","pr-2"),n.type="button",n.innerHTML='<svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="transition-[stroke,opacity] opacity-60 group-hover:opacity-100"><path d="M8 3H7.8C6.11984 3 5.27976 3 4.63803 3.32698C4.07354 3.6146 3.6146 4.07354 3.32698 4.63803C3 5.27976 3 6.11984 3 7.8V8M8 21H7.8C6.11984 21 5.27976 21 4.63803 20.673C4.07354 20.3854 3.6146 19.9265 3.32698 19.362C3 18.7202 3 17.8802 3 16.2V16M21 8V7.8C21 6.11984 21 5.27976 20.673 4.63803C20.3854 4.07354 19.9265 3.6146 19.362 3.32698C18.7202 3 17.8802 3 16.2 3H16M21 16V16.2C21 17.8802 21 18.7202 20.673 19.362C20.3854 19.9265 19.9265 20.3854 19.362 20.673C18.7202 21 17.8802 21 16.2 21H16M7.5 8V9.5M16.5 8V9.5M11 12.6001C11.8 12.6001 12.5 11.9001 12.5 11.1001V8M15.2002 15.2C13.4002 17 10.5002 17 8.7002 15.2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',document.createElement("span"));return i.textContent=getTranslationBabel("Find face"),n.onclick=function(){var e=document.querySelector(".footer-preview");e&&("img"===e.tagName.toLowerCase()&&e.src?createModalDetectImage(sendModuleData.sourceFile.urlFile,this,null):"video"===e.tagName.toLowerCase()&&e.src&&createModalDetectVideo(sendModuleData.sourceFile.urlFile,this,null))},n.appendChild(i),t.appendChild(a),t.appendChild(l),o.appendChild(n),e.appendChild(t),e.appendChild(o),e}function setButtonSelectAudioLipSync(){var e=document.createElement("div"),t=(e.classList.add("relative","group"),document.createElement("div")),a=(t.classList.add("hidden","absolute","p-2","group-hover:flex","items-center","gap-3","bottom-full","left-1/2","-translate-x-1/2","-translate-y-3.5","bg-dark-elements-hover","rounded-md","w-[300px]"),document.createElement("img")),l=(a.classList.add("w-20","h-20","rounded-md"),a.src="/static/modules/thumbnail/attach_speech.png",a.alt="Load audio explain",a.width=256,a.height=256,document.createElement("span")),o=(l.classList.add("text-m-mobile","lg:text-m"),l.style="display: inline-block; vertical-align: top; text-decoration: inherit; text-wrap: balance;",l.textContent=getTranslationBabel("For best results, use in Lip Sync a high-quality audio without noise."),document.createElement("div")),n=(o.classList.add("module-button-div","relative","flex","gap-2","items-center","rounded-md","bg-light-emphasis"),document.createElement("button")),i=(n.classList.add("lip-sync-button","stroke-danger-primary","text-danger-primary","relative","flex","gap-2","items-center","group","py-1.5","pl-2","whitespace-nowrap","font-extra-thick","pr-2"),n.type="button",n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none" style="scale: 1.2;" class="w-4 h-4 transition-[stroke,opacity] opacity-60 group-hover:opacity-100"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M2 9c6.5 0 6 1.5 8 1.5S11.5 9 18 9m.8 0S16 15.5 10 15.5C4 15.5 1.2 9 1.2 9S3.5 5 6 4.5 10 6 10 6s1.5-2 4-1.5S18.8 9 18.8 9Z"></path></svg>',document.createElement("span"));return i.textContent=getTranslationBabel("Attach speech"),n.onclick=function(){document.querySelector(".footer-preview")&&createModalLoadOneAudio(getTranslationBabel("sample speech"),setParametersAudioLipSync)},n.appendChild(i),t.appendChild(a),t.appendChild(l),o.appendChild(n),e.appendChild(t),e.appendChild(o),e}function setButtonSelectAnalysis(){var e=document.createElement("div"),t=(e.classList.add("relative","group"),document.createElement("div")),a=(t.classList.add("hidden","absolute","p-2","group-hover:flex","items-center","gap-3","bottom-full","left-1/2","-translate-x-1/2","-translate-y-3.5","bg-dark-elements-hover","rounded-md","w-[300px]"),document.createElement("img")),l=(a.classList.add("w-20","h-20","rounded-md"),a.src="/static/modules/thumbnail/analyser.png",a.alt="Fake detector",a.width=256,a.height=256,document.createElement("span")),o=(l.classList.add("text-m-mobile","lg:text-m"),l.style="display: inline-block; vertical-align: top; text-decoration: inherit; text-wrap: balance;",l.textContent=getTranslationBabel("Got a sneaky suspicion about some content? Ready to sniff out those deepfakes? Just hit that button."),document.createElement("div")),n=(o.classList.add("module-button-div","relative","flex","gap-2","items-center","rounded-md","bg-light-emphasis"),document.createElement("button")),i=(n.classList.add("relative","flex","gap-2","items-center","group","py-1.5","pl-2","whitespace-nowrap","font-extra-thick","pr-2"),n.type="button",n.innerHTML='<svg width="20px" height="20px" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill="white" class="w-4 h-4 transition-[stroke,opacity] opacity-60 group-hover:opacity-100"><path d="M1.5 1a.5.5 0 0 0-.5.5v3a.5.5 0 0 1-1 0v-3A1.5 1.5 0 0 1 1.5 0h3a.5.5 0 0 1 0 1h-3zM11 .5a.5.5 0 0 1 .5-.5h3A1.5 1.5 0 0 1 16 1.5v3a.5.5 0 0 1-1 0v-3a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 1-.5-.5zM.5 11a.5.5 0 0 1 .5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 1 0 1h-3A1.5 1.5 0 0 1 0 14.5v-3a.5.5 0 0 1 .5-.5zm15 0a.5.5 0 0 1 .5.5v3a1.5 1.5 0 0 1-1.5 1.5h-3a.5.5 0 0 1 0-1h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 1 .5-.5zM3 4.5a.5.5 0 0 1 1 0v7a.5.5 0 0 1-1 0v-7zm2 0a.5.5 0 0 1 1 0v7a.5.5 0 0 1-1 0v-7zm2 0a.5.5 0 0 1 1 0v7a.5.5 0 0 1-1 0v-7zm2 0a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-7zm3 0a.5.5 0 0 1 1 0v7a.5.5 0 0 1-1 0v-7z"/></svg>',document.createElement("span"));return i.textContent=getTranslationBabel("Analysis"),n.onclick=function(){document.querySelector(".footer-preview")&&createModalLoadAnalysis(sendModuleData.sourceFile.urlFile,sendModuleData.sourceFile.formatFile)},n.appendChild(i),t.appendChild(a),t.appendChild(l),o.appendChild(n),e.appendChild(t),e.appendChild(o),e}async function fetchModalLipSyncSubmit(){var e,t,a;return totalVRAMGB<6?fetchSendModuleDataLipSync():(e=(a=function(){let e=!1,t=!1;if(!Array.isArray(sendModuleData.moduleParameters.cropField))return console.log("Crop field is not array"),{tmpFileNameSrc:e,tmpFileNameAudio:t,validMessage:getTranslationBabel("Wow! Seems like you didn’t pick a face in your content witch need to animate. Click on the «Find face» button and set box on person face, please!")};if(0===sendModuleData.moduleParameters.cropField.length)return console.log("Crop field of source file is empty"),{tmpFileNameSrc:e,tmpFileNameAudio:t,validMessage:getTranslationBabel("Wow! Seems like you didn’t pick a face in your content witch need to animate. Click on the «Find face» button and set box on person face, please!")};if(""===sendModuleData.moduleParameters.nameFile.trim()&&(sendModuleData.moduleParameters.nameFile=generateUUID()),"number"!=typeof sendModuleData.sourceFile.offsetWidth||isNaN(sendModuleData.sourceFile.offsetWidth))return console.log("Offset width is not a number or is empty"),{tmpFileNameSrc:e,tmpFileNameAudio:t,validMessage:getTranslationBabel("Uh-oh! The width looks wonky. Double-check it’s a number and not empty. Maybe click on «Select object» or load another file.")};if("number"!=typeof sendModuleData.sourceFile.offsetHeight||isNaN(sendModuleData.sourceFile.offsetHeight))return console.log("Offset height is not a number or is empty"),{tmpFileNameSrc:e,tmpFileNameAudio:t,validMessage:getTranslationBabel("Hmm... The height seems fishy. Verify it’s a number and not empty. Check it’s a number and not empty. Maybe click on «Select object» or load another file.")};if(["jpg","jpeg","png","gif","bmp"].includes(sendModuleData.sourceFile.formatFile.toLowerCase()))e=generateImageFilename();else{if(!["mp4","avi","mov","wmv","mkv"].includes(sendModuleData.sourceFile.formatFile.toLowerCase()))return console.log("The format file is neither an image nor a video format."),{tmpFileNameSrc:e,tmpFileNameAudio:t,validMessage:getTranslationBabel("Yikes! Looks like an alien format. Stick to images or videos for now.")};e=generateVideoFilename()}return sendModuleData.audioFile.formatFile&&["wav","mp3"].includes(sendModuleData.audioFile.formatFile.toLowerCase())?(t=generateAudioFilename(),{tmpFileNameSrc:e,tmpFileNameAudio:t,validMessage:""}):(console.log("The format file is neither an audio format."),{tmpFileNameSrc:e,tmpFileNameAudio:t,validMessage:getTranslationBabel("Yikes! Looks like an alien format. Stick to audio speech for now.")})}()).tmpFileNameSrc,t=a.tmpFileNameAudio,a=a.validMessage,e&&t?(async function(){"ontouchstart"in window||navigator.msMaxTouchPoints;var e=document.querySelector(".modal-lip-sync-template").content.cloneNode(!0);const t=e.querySelector(".modal-root");var a=t.querySelector(".fast-submit"),l=t.querySelector(".best-submit");a.onclick=async function(){sendModuleData.moduleParameters.useDiffuser=!1,fetchSendModuleDataLipSync(),t.remove()},l.onclick=async function(){await createConnection(async function(){sendModuleData.moduleParameters.useDiffuser=!0,fetchSendModuleDataLipSync(),t.remove()})},document.body.appendChild(e)}(),{statusBool:!0,validMessage:""}):{statusBool:!1,validMessage:a})}function setParametersAudioLipSync(e,t,a){sendModuleData.audioFile.urlFile=e,sendModuleData.audioFile.formatFile="wav",sendModuleData.audioFile.startTime=t,sendModuleData.audioFile.endTime=a;e=document.querySelector(".lip-sync-button");e&&e instanceof HTMLElement&&(console.log("Audio lip sync loaded."),e.classList.add("text-accent-primary","stroke-accent-primary"),e.classList.remove("text-danger-primary","stroke-danger-primary"))}function setLiteSetting(){const e=getTranslationBabel("lip sync");var t=document.querySelector("#settings");t.href="",t.onclick=async function(){event.preventDefault(),createModalLiteSetting(e,"LIP_SYNC")}}setLiteSetting(),createFooterFile(callbacks,pageFileFormats);