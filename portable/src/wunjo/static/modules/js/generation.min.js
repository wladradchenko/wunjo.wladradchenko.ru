class SendModuleDataGeneration{constructor(e){this.method=e,this.subMethod=e,this.moduleParameters={nameFile:generateUUID(),aspectRatio:1.77,sdModel:initDefaultSdModel(),videoModel:initDefaultVideoModel(),positivePrompt:null,negativePrompt:null,seed:-1,strength:.75,scale:5,numberInferenceSteps:20,controlStrength:.7,blurFactor:10,FPS:12,duration24FPS:null},this.sourceFile={nameFile:null,urlFile:null,formatFile:null,fileSizeBytes:null,naturalWidth:null,naturalHeight:null,offsetWidth:null,offsetHeight:null,startTime:null,endTime:null},this.updatableKeys=new Set(["moduleParameters.nameFile","moduleParameters.aspectRatio","moduleParameters.sdModel","moduleParameters.videoModel","moduleParameters.positivePrompt","moduleParameters.negativePrompt","moduleParameters.seed","moduleParameters.strength","moduleParameters.scale","moduleParameters.numberInferenceSteps","moduleParameters.controlStrength","moduleParameters.blurFactor","moduleParameters.FPS","moduleParameters.duration24FPS"])}clearSourceFile(){this.sourceFile={nameFile:null,urlFile:null,formatFile:null,fileSizeBytes:null,naturalWidth:null,naturalHeight:null,offsetWidth:null,offsetHeight:null,startTime:null,endTime:null}}updateData(e){if(this.updatableKeys&&this.updatableKeys instanceof Set){const n=(e,t,a="")=>{for(const l in t){var o=a?a+"."+l:l;this.updatableKeys.has(o)&&l in e?e[l]=t[l]:"object"==typeof t[l]&&null!==t[l]&&l in e&&n(e[l],t[l],o)}};n(this,e)}else console.warn("updateData: updatableKeys not defined, update cancelled.")}}const callbacks={fetchSendModuleDataCallback:openModalGenerationSubmit,setClearCallback:function(){sendModuleData.clearSourceFile()},toggleModificationCallback:!0,setTextareaCallback:setTextareaGeneration,setMetaButtonCallback:setMetaButtonGeneration,setMotionButtonCallback:!1,setParametersButtonCallback:setParametersButtonGeneration,setModuleImgButtonsCallback:setModuleImgButtons,setModuleVideoButtonsCallback:!1,setModuleAudioButtonsCallback:!1,setDefaultSendModuleData:SendModuleDataGeneration};let sendModuleData=new SendModuleDataGeneration(moduleName);function initDefaultSdModel(){for(const e of sdModels)if(e.hasOwnProperty("model"))return e.model;return null}function initDefaultVideoModel(){for(const e of videoModels)if(e.hasOwnProperty("model"))return e.model;return null}function getCustomRandomModel(){var t=sdModels;for(let e=t.length-1;0<e;e--){var a=Math.floor(Math.random()*(e+1));[t[e],t[a]]=[t[a],t[e]]}for(const e of sdModels)if(e.hasOwnProperty("model")&&e.model)return e.model;return null}function setAspectRatio(i=null){var e=document.createElement("div");e.classList.add("w-full","flex","flex-col","gap-3","mb-2","rounded-md","col-start-1","col-span-1","row-start-5","gap-2.5","p-2.5","bg-opacity-30","rounded-md","bg-dark-tags","flex","flex-col","gap-5","overflow-auto","transition-[height_max-height]","pr-2","row-span-3"),(aspectRatioTitleDiv=document.createElement("div")).classList.add("flex","gap-3","items-center","justify-between"),(aspectRatioTitleP=document.createElement("p")).classList.add("font-extra-thick"),aspectRatioTitleP.textContent=getTranslationBabel("Aspect ratio"),aspectRatioTitleDiv.appendChild(aspectRatioTitleP);const s=document.createElement("div");function d(e,t,a=0){var[e,o]=e.split(":").map(Number);let l,n;o<=e?(l=t,n=t/e*o):(n=t,l=t/o*e);t=Math.pow(10,a);return l=Math.round(l*t)/t,n=Math.round(n*t)/t,{width:l,height:n}}s.classList.add("flex","gap-2","flex-wrap");const t=["16:9","9:16","1:1","5:2","5:3","4:5","4:3"];let c=null,u=null;return getLimitResolution(moduleName).then(r=>{t.forEach((e,t)=>{const a=d(e,r,0);var o=d(e,20,2);const l=document.createElement("button"),n=(l.textContent=e,l.type="button",l.classList.add("aspect-ratio-btn","rounded-md","flex","items-center","justify-center","transition-colors","font-normal","disabled:cursor-not-allowed","px-4","gap-2","py-2.5","flex-1","!bg-dark-elements-upper","!text-light-primary","hover:bg-dark-elements-hover","text-light-primary","bg-dark-pop-up"),document.createElement("span"));n.classList.add("max-w-5","max-h-5","border-[1.5px]","rounded-sm","shrink-0","transition-[border-color]","border-light-secondary"),n.style.width=o.width+"px",n.style.height=o.height+"px",0===t&&(sendModuleData.moduleParameters.aspectRatio=a.width/a.height,c=l,u=n,l.classList.remove("!bg-dark-elements-upper","!text-light-primary"),l.classList.add("!bg-accent-primary","!text-dark-background"),n.classList.remove("border-light-secondary"),n.classList.add("border-dark-background")),l.onclick=function(){sendModuleData.moduleParameters.aspectRatio=a.width/a.height,c&&(c.classList.add("!bg-dark-elements-upper","!text-light-primary"),c.classList.remove("!bg-accent-primary","!text-dark-background")),u&&(u.classList.add("border-light-secondary"),u.classList.remove("border-dark-background")),l.classList.remove("!bg-dark-elements-upper","!text-light-primary"),l.classList.add("!bg-accent-primary","!text-dark-background"),n.classList.remove("border-light-secondary"),n.classList.add("border-dark-background"),c=l,u=n,i&&"function"==typeof i&&i()},l.appendChild(n),s.appendChild(l)})}).catch(e=>{}),e.appendChild(aspectRatioTitleDiv),e.appendChild(s),e}async function openModalGenerationSubmit(){var e=document.querySelector(".modal-visual-generate-template").content.cloneNode(!0),t=e.querySelector(".modal-root"),a=(t.querySelector(".modal-canvas"),t.querySelector(".modal-parameters")),o=t.querySelector(".modal-redraw-btn");const l=t.querySelector(".modal-generate-btn"),n=t.querySelector(".duration-list"),r=getTranslationBabel("sec");function i(e){e=e.target;n.contains(e)||l.contains(e)||(n.classList.add("hidden"),document.removeEventListener("click",i))}return a.appendChild(function(){var e=document.createElement("div"),t=(e.classList.add("flex","flex-col","gap-5","overflow-auto","transition-[height_max-height]","pr-2","gap-2.5","text-m-mobile","md:tex-m","p-2.5","bg-opacity-30","rounded-md","bg-dark-tags","text-s","flex","flex-col","gap-5","overflow-auto","transition-[height_max-height]","pr-2"),e.style.maxHeight="calc(933px - var(--navbar-height) - 60px)",document.createElement("div")),a=(t.classList.add("flex","gap-3","items-center","justify-between"),document.createElement("p"));a.classList.add("font-extra-thick"),a.textContent=getTranslationBabel("Model");const r=document.createElement("div");r.classList.add("grid-cols-2","gap-5","grid","overflow-auto"),r.style.maxHeight="6.9rem";let i=0;return videoModels.forEach(e=>{var t,a;if((!sendModuleData.sourceFile.urlFile||"text"!==e.type)&&((sendModuleData.sourceFile.urlFile||"image"!==e.type)&&e.hasOwnProperty("model"))){var o=document.createElement("div");o.classList.add("group","flex","flex-col","justify-center","items-center","text-center");const n=document.createElement("button");n.classList.add("model-picker","relative","w-[5.625rem]","h-[5.625rem]","rounded-md","opacity-60","group-hover:opacity-100","transition-all"),n.type="button";var l=document.createElement("p");l.classList.add("w-[5.625rem]"),l.style="white-space: nowrap;overflow: hidden;text-overflow: ellipsis;",e.hasOwnProperty("name")?l.textContent=e.name:l.textContent=(t=e.model)?(a=t.lastIndexOf("."),t.substring(0,a).replace(/_/g," ").toLowerCase().replace(/^\w/,e=>e.toUpperCase())):"Unknown",sendModuleData.moduleParameters.videoModel?sendModuleData.moduleParameters.videoModel===e.model&&(n.classList.remove("opacity-60"),n.style.border="2px solid white"):0===i&&(n.classList.remove("opacity-60"),n.style.border="2px solid white",sendModuleData.moduleParameters.videoModel=e.model),e.hasOwnProperty("img")?n.style.backgroundImage=`url(${e.img})`:(n.style.backgroundColor="#0d0d0d",e.name&&(n.textContent=""+e.name[0],n.style.fontSize="xx-large",n.style.fontWeight="bold")),n.style.backgroundSize="cover",n.style.backgroundPosition="center",n.onclick=function(){r.querySelectorAll(".model-picker").forEach(e=>{e.classList.add("opacity-60"),e.style.border=""}),this.classList.remove("opacity-60"),this.style.border="2px solid white";var e=n.getAttribute("model");sendModuleData.moduleParameters.videoModel=e},e.hasOwnProperty("url")&&(n.title=e.url),e.model&&n.setAttribute("model",e.model),o.appendChild(n),o.appendChild(l),r.appendChild(o),i++}}),t.appendChild(a),e.appendChild(t),e.appendChild(r),e}()),a.appendChild(function(){var e=document.createElement("div"),t=(e.classList.add("flex","gap-4","flex-col","gap-2.5","text-m-mobile","md:tex-m","p-2.5","bg-opacity-30","rounded-md","bg-dark-tags","text-s","flex","flex-col","gap-5","overflow-auto","transition-[height_max-height]","pr-2"),sendModuleData.moduleParameters.FPS),a=document.createElement("div"),o=(a.classList.add("flex","gap-3","items-center","justify-between"),document.createElement("p"));o.classList.add("font-extra-thick"),o.textContent=getTranslationBabel("Frames per second");const l=document.createElement("input");l.classList.add("px-2","py-1.5","rounded-md","bg-dark-elements","w-8","box-content","text-center","outline-none"),l.min="12",l.max="24",l.step="1",l.value=t,l.type="number";var n=document.createElement("div"),r=(n.classList.add("flex","gap-4","items-center","text-m-mobile","lg:text-m"),document.createElement("span"));r.classList.add("opacity-60"),r.textContent=l.min,r.title=getTranslationBabel("Reduce control strength to less depend to frames.");const i=document.createElement("input");i.classList.add("relative","slider","flex-1","appearance-none","h-1","bg-light-border","rounded-md","outline-none","after:absolute","after:left-0","after:top-0","after:h-1","after:rounded-md","after:bg-accent-primary","after:w-[var(--fill-size)]","after:z-0"),i.min="12",i.max="24",i.step="1",i.value=t;let s=Math.ceil((i.value-i.min)/(i.max-i.min)*100);return i.style.setProperty("--fill-size",s+"%"),i.type="range",(t=document.createElement("span")).classList.add("opacity-60"),t.textContent=l.max,t.title=getTranslationBabel("Increase control strength to up depend to frames."),l.addEventListener("change",function(){sendModuleData.moduleParameters.FPS=this.value,i.value=this.value,s=Math.ceil((this.value-this.min)/(this.max-this.min)*100),i.style.setProperty("--fill-size",s+"%")}),i.addEventListener("input",function(){sendModuleData.moduleParameters.FPS=this.value,l.value=this.value,s=Math.ceil((this.value-this.min)/(this.max-this.min)*100),i.style.setProperty("--fill-size",s+"%")}),a.appendChild(o),a.appendChild(l),n.appendChild(r),n.appendChild(i),n.appendChild(t),e.appendChild(a),e.appendChild(n),e}()),sendModuleData.sourceFile.urlFile||((t=document.createElement("div")).classList.add("text-m-mobile","md:tex-m","text-s"),t.appendChild(setAspectRatio()),a.appendChild(t)),o.onclick=function(){createModalVisualRedraw()},l.onclick=function(){var e=videoModels.find(e=>e.model===sendModuleData.moduleParameters.videoModel),e=e?e.duration_24fps:null;Array.isArray(e)&&(1<e.length?(n.innerHTML="",n.classList.remove("hidden"),e.forEach(e=>{var t=document.createElement("div"),a=(t.classList.add("flex","flex-col","gap-3","text-black","w-full","group"),document.createElement("button"));a.classList.add("flex","rounded-md","gap-2","py-1.5","px-2","flex-1","justify-start","hover:bg-accent-hover"),a.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="black" class="opacity-60 group-hover:opacity-100 group-hover:-mt-0.5 transition-all"><path d="M8.33334 1.66669H11.6667M10 11.6667V8.33335M3.33334 10.8334C3.5374 9.21333 4.32889 7.72453 5.55772 6.6493C6.78654 5.57408 8.36724 4.98722 10 5.00002C11.0784 5.00117 12.1404 5.26389 13.0949 5.76565C14.0494 6.26742 14.868 6.99325 15.4804 7.88087C16.0927 8.7685 16.4807 9.79143 16.6108 10.8619C16.741 11.9324 16.6096 13.0185 16.2278 14.027C15.846 15.0355 15.2252 15.9364 14.4188 16.6523C13.6123 17.3682 12.6442 17.8778 11.5976 18.1374C10.5509 18.3969 9.45688 18.3987 8.40937 18.1425C7.36186 17.8864 6.39212 17.38 5.58334 16.6667L3.33334 14.6667M7.50001 14.1667H3.33334V18.3334" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg><span>${Math.ceil(24*e/sendModuleData.moduleParameters.FPS)} (${r})</span>`,t.append(a),n.append(t),a.onclick=async()=>{sendModuleData.moduleParameters.duration24FPS=e,fetchSendModuleDataVideoGeneration(),closeModal(this)}}),setTimeout(()=>{document.addEventListener("click",i)},100)):1===e.length&&(sendModuleData.moduleParameters.duration24FPS=e[0],fetchSendModuleDataVideoGeneration(),closeModal(this)))},document.body.appendChild(e),{statusBool:!0,validMessage:""}}function setTextareaGeneration(e=0){var t=document.createElement("div");t.classList.add("w-full","relative","flex","items-center","gap-2","bg-dark-elements","rounded-[.625rem]","pl-4","pr-2");const a=document.createElement("textarea");a.classList.add("bg-transparent","my-1","appearance-none","font-mono","outline-none","w-full","resize-none","placeholder:text-light-secondary","flex-1","h-5","disabled:cursor-not-allowed","lg:text-regular","text-regular-mobile"),a.rows=1,a.placeholder=getTranslationBabel("Describe the change you want to make"),a.maxlength=3e3;var o=document.createElement("div"),l=(o.classList.add("max-md:hidden","flex","gap-3","items-center"),document.createElement("button"));l.classList.add("opacity-60","hover:opacity-100","flex","gap-2","items-center","relative","opacity-60","hover:opacity-100","transition-opacity","py-1.5","px-0","confetti-button"),l.title=getTranslationBabel("Inspire me"),l.type="button",l.innerHTML='<svg fill="white" width="30px" height="30px" viewBox="0 0 256 256" xmlns="http://www.w3.org/2000/svg"><g fill-rule="evenodd"> <path d="M47.895 88.097c.001-4.416 3.064-9.837 6.854-12.117l66.257-39.858c3.785-2.277 9.915-2.277 13.707.008l66.28 39.934c3.786 2.28 6.853 7.703 6.852 12.138l-.028 79.603c-.001 4.423-3.069 9.865-6.848 12.154l-66.4 40.205c-3.781 2.29-9.903 2.289-13.69-.01l-66.167-40.185c-3.78-2.295-6.842-7.733-6.84-12.151l.023-79.72zm13.936-6.474l65.834 36.759 62.766-36.278-62.872-36.918L61.83 81.623zM57.585 93.52c0 1.628-1.065 71.86-1.065 71.86-.034 2.206 1.467 4.917 3.367 6.064l61.612 37.182.567-77.413s-64.48-39.322-64.48-37.693zm76.107 114.938l60.912-38.66c2.332-1.48 4.223-4.915 4.223-7.679V93.125l-65.135 37.513v77.82z"></path><path d="M77.76 132.287c-4.782 2.762-11.122.735-14.16-4.526-3.037-5.261-1.622-11.765 3.16-14.526 4.783-2.762 11.123-.735 14.16 4.526 3.038 5.261 1.623 11.765-3.16 14.526zm32 21c-4.782 2.762-11.122.735-14.16-4.526-3.037-5.261-1.622-11.765 3.16-14.526 4.783-2.762 11.123-.735 14.16 4.526 3.038 5.261 1.623 11.765-3.16 14.526zm-32 16c-4.782 2.762-11.122.735-14.16-4.526-3.037-5.261-1.622-11.765 3.16-14.526 4.783-2.762 11.123-.735 14.16 4.526 3.038 5.261 1.623 11.765-3.16 14.526zm32 21c-4.782 2.762-11.122.735-14.16-4.526-3.037-5.261-1.622-11.765 3.16-14.526 4.783-2.762 11.123-.735 14.16 4.526 3.038 5.261 1.623 11.765-3.16 14.526zm78.238-78.052c-4.783-2.762-11.122-.735-14.16 4.526-3.037 5.261-1.623 11.765 3.16 14.526 4.783 2.762 11.123.735 14.16-4.526 3.038-5.261 1.623-11.765-3.16-14.526zm-16.238 29c-4.782-2.762-11.122-.735-14.16 4.526-3.037 5.261-1.622 11.765 3.16 14.526 4.783 2.762 11.123.735 14.16-4.526 3.038-5.261 1.623-11.765-3.16-14.526zm-17 28c-4.782-2.762-11.122-.735-14.16 4.526-3.037 5.261-1.622 11.765 3.16 14.526 4.783 2.762 11.123.735 14.16-4.526 3.038-5.261 1.623-11.765-3.16-14.526zM128.5 69c-6.351 0-11.5 4.925-11.5 11s5.149 11 11.5 11S140 86.075 140 80s-5.149-11-11.5-11z"></path></g></svg>';let n=sendModuleData.moduleParameters.positivePrompt;return Object.defineProperty(sendModuleData.moduleParameters,"positivePrompt",{get(){return n},set(e){n!==e&&(n=e,a.value=e)}}),a.addEventListener("click",function(){createModalVisualTextarea()}),l.addEventListener("click",function(){a.value=getRandomPrompt(),sendModuleData.moduleParameters.positivePrompt=a.value}),o.appendChild(l),t.appendChild(a),t.appendChild(o),t}function getRandomPrompt(){var e=[getTranslationBabel("A stuffed animal donkey grazing in a valley"),getTranslationBabel("Cinematic, sunny day, waves crashing on the shore of a beach"),getTranslationBabel("A cow grazing in a valley during the day, a UFO approaches in the distance"),getTranslationBabel("A flower blooming in slow motion"),getTranslationBabel("3D render, a raccoon holding a mini ice cream cone"),getTranslationBabel("POV of a car driving in outer space traveling through time, time travel tunnel"),getTranslationBabel("2 cats in love eating a candlelit dinner of fresh fish"),getTranslationBabel("Cinematic, a dog in a car window"),getTranslationBabel("Moody, filmic, 35mm, a doctor walking into the hospital"),getTranslationBabel("POV of a car driving in outer space traveling through time, time travel tunnel"),getTranslationBabel("3D render, goldfish swimming in a glass container"),getTranslationBabel("Nature documentary, jellyfish swimming in the ocean"),getTranslationBabel("Cinematic, a Tibetan monk sitting in a temple on a mountain, facing camera."),getTranslationBabel("Nature documentary, natural lighting, flamingo walking in a beautiful beach, head turning"),getTranslationBabel("Low angle dolly in shot, a wild west town with saloons and dusty streets"),getTranslationBabel("A secret garden with a rainbow waterfall"),getTranslationBabel("Cinematic, a cowboy riding a horse on mirror-like lake, moving clouds"),getTranslationBabel("Cinematic, long tracking shot of the cliffs of Dover"),getTranslationBabel("1950s film style, a seagull on a boat"),getTranslationBabel("Cinematic, sunny day, waves crashing on the shore of a beach"),getTranslationBabel("A woman smiling while watching fireworks"),getTranslationBabel("Beautiful sunset at the beach, silhouette of a couple walking by the seashore against sunset, beautiful scenery"),getTranslationBabel("Low angle dolly in shot, a wild west town with saloons and dusty streets"),getTranslationBabel("Anime, a boy and a girl sitting on the grass under the starry sky"),getTranslationBabel("Nature documentary, close up of a lizard in a desert"),getTranslationBabel("1940s newsreel footage, a soldier stands watch on a rocky hill, facing camera"),getTranslationBabel("Anime, a woman walking home with groceries, wide angle"),getTranslationBabel("Watercolor style of a baby elephant drinking water from a lake in the desert"),getTranslationBabel("Futuristic film of a man walking on a street in Paris, cinematic, symmetric composition"),getTranslationBabel("Claymation, stop motion, a rat sitting on a huge block of cheese")];return e[Math.floor(Math.random()*e.length)]}function createModalVisualTextarea(){"ontouchstart"in window||navigator.msMaxTouchPoints;var e=document.querySelector(".modal-visual-textarea-template").content.cloneNode(!0);const t=e.querySelector(".modal-root"),a=(t.querySelector("p").innerHTML=`<b class="text-accent-primary">${getTranslationBabel("Prompt")}:</b> `+getTranslationBabel("Itâ€™s like describe a genie your wishes so they can conjure up just what you need!"),t.querySelector(".modal-positive-prompt")),o=(a.placeholder=""+getTranslationBabel("(Optional) Describe your prompt for generation, or leave it blank for a random request. You can use (word) to emphasize specific requests and word:non-integers number from 0 to 1 for request intensity. For example, dog:0.8, cat:0.2 in one prompt. The maximum number of symbols is 3000."),a.maxlength=3e3,sendModuleData.moduleParameters.positivePrompt&&(a.value=sendModuleData.moduleParameters.positivePrompt),t.querySelector(".modal-negative-prompt")),l=t.querySelectorAll(".modal-seed"),n=t.querySelectorAll(".modal-strength");var r=t.querySelectorAll(".modal-strength-slider");const i=t.querySelectorAll(".modal-scale");var s=t.querySelectorAll(".modal-scale-slider");const d=t.querySelectorAll(".modal-number-steps");var c=t.querySelectorAll(".modal-number-steps-slider");a.value=sendModuleData.moduleParameters.positivePrompt,o.value=sendModuleData.moduleParameters.negativePrompt,l.forEach(e=>{e.value=sendModuleData.moduleParameters.seed}),n.forEach(e=>{e.value=sendModuleData.moduleParameters.strength}),r.forEach(e=>{e.value=sendModuleData.moduleParameters.strength,strengthFillSize=Math.ceil((e.value-e.min)/(e.max-e.min)*100),e.style.setProperty("--fill-size",strengthFillSize+"%")}),i.forEach(e=>{e.value=sendModuleData.moduleParameters.scale}),s.forEach(e=>{e.value=sendModuleData.moduleParameters.scale,scaleFillSize=Math.ceil((e.value-e.min)/(e.max-e.min)*100),e.style.setProperty("--fill-size",scaleFillSize+"%")}),d.forEach(e=>{e.value=sendModuleData.moduleParameters.numberInferenceSteps}),c.forEach(e=>{e.value=sendModuleData.moduleParameters.numberInferenceSteps,numberInferenceFillSize=Math.ceil((e.value-e.min)/(e.max-e.min)*100),e.style.setProperty("--fill-size",numberInferenceFillSize+"%")});const u=Math.floor(1000001*Math.random());function m(e,t,a){const o=Math.max(Math.min(a.value,a.max),a.min),l=Math.ceil((o-a.min)/(a.max-a.min)*100);e.forEach(e=>{e.value=o,e.style.setProperty("--fill-size",l+"%")}),t.forEach(e=>{e.value=o})}function h(t,a){t.forEach(e=>{e.addEventListener("change",function(){m(a,t,this)})}),a.forEach(e=>{e.addEventListener("input",function(){m(a,t,this)})})}l.forEach(e=>{e.value||(e.value=u)}),l.forEach(e=>{e.addEventListener("change",function(e){const t=e.target.value;l.forEach(e=>{e.value=t})})}),h(n,r),h(i,s),h(d,c),t.querySelector(".submit-text").onclick=function(){sendModuleData.moduleParameters.positivePrompt=a.value,sendModuleData.moduleParameters.negativePrompt=o.value,sendModuleData.moduleParameters.seed=l[0].value,sendModuleData.moduleParameters.strength=n[0].value,sendModuleData.moduleParameters.scale=i[0].value,sendModuleData.moduleParameters.numberInferenceSteps=d[0].value,closeModal(t)},document.body.appendChild(e)}async function createModalImageComposition(){"ontouchstart"in window||navigator.msMaxTouchPoints;var e=document.querySelector(".modal-image-composition-template").content.cloneNode(!0);const o=e.querySelector(".modal-root"),a=o.querySelector(".image"),n=o.querySelector(".modal-identity-preserving-btn");var t=o.querySelector(".upload"),l=o.querySelector(".download");const r=o.querySelector(".modal-positive-prompt");r.placeholder=""+getTranslationBabel("Use the prompt field to describe your composition. Click on an image to insert its placeholder into the text automatically. You can add as many images as you like. Example placeholder format: A man image_1 in t-short image_2. Also you can use coefficient. For example, dog:0.8, cat:0.2 in one prompt. The maximum number of symbols is 3000."),r.maxlength=3e3,sendModuleData.moduleParameters.positivePrompt&&(r.value=sendModuleData.moduleParameters.positivePrompt);const i=o.querySelector(".image-composition-sources");var s=o.querySelector("#image-composition-input");const d=o.querySelectorAll(".modal-seed"),c=o.querySelectorAll(".modal-scale");var u=o.querySelectorAll(".modal-scale-slider");const m=o.querySelectorAll(".modal-width");var h=o.querySelectorAll(".modal-width-slider");const p=o.querySelectorAll(".modal-height");var g=o.querySelectorAll(".modal-height-slider");const f=[],v=Math.floor(1000001*Math.random());function y(e=null,o=null){f.push(o);const t=document.createElement("div");t.classList.add("group");var a=document.createElement("label"),l=(a.classList.add("w-20","h-20","relative","flex","flex-row","text-center","items-center","justify-center","gap-3","cursor-pointer","bg-dark-elements","rounded-[.625rem]","border","border-dashed","border-white","border-opacity-20","py-6"),document.createElement("button")),n=document.createElement("img"),e=(n.setAttribute("data-name",o),n.src=e,n.classList.add("w-20","h-20","object-cover","rounded-[.625rem]","opacity-60","group-hover:opacity-100"),l.appendChild(n),document.createElement("button"));e.classList.add("rounded-md","flex","items-center","justify-center","transition-colors","font-normal","disabled:cursor-not-allowed","px-1.5","gap-1.5","py-1.5","opacity-0","group-hover:opacity-100","transition-opacity","absolute","top-1","right-1","z-[1]","full-opacity-on-touchscreen","!bg-dark-pop-up","hover:bg-dark-elements-hover","text-light-primary","bg-dark-elements"),e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="white"><g><path d="M2.5 4.99996H17.5M15.8333 4.99996V16.6666C15.8333 17.5 15 18.3333 14.1667 18.3333H5.83333C5 18.3333 4.16667 17.5 4.16667 16.6666V4.99996M6.66667 4.99996V3.33329C6.66667 2.49996 7.5 1.66663 8.33333 1.66663H11.6667C12.5 1.66663 13.3333 2.49996 13.3333 3.33329V4.99996M8.33333 9.16663V14.1666M11.6667 9.16663V14.1666" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></g></svg>',a.appendChild(l),o!==sendModuleData.sourceFile.nameFile&&a.appendChild(e),t.appendChild(a),i.appendChild(t),n.onclick=async function(){var e=r.selectionStart,t=r.selectionEnd,a=r.value;r.value=a.slice(0,e)+` ${o} `+a.slice(t),r.selectionStart=r.selectionEnd=e+` ${o} `.length,r.focus()},e.onclick=function(){var e=f.indexOf(o);-1!==e&&f.splice(e,1),t.remove()}}function b(e,t,a){const o=Math.max(Math.min(a.value,a.max),a.min),l=Math.ceil((o-a.min)/(a.max-a.min)*100);e.forEach(e=>{e.value=o,e.style.setProperty("--fill-size",l+"%")}),t.forEach(e=>{e.value=o})}function w(t,a){t.forEach(e=>{e.addEventListener("change",function(){b(a,t,this)})}),a.forEach(e=>{e.addEventListener("input",function(){b(a,t,this)})})}function M(e=null,t=!1){n.disabled=t,e&&(a.src=e)}d.forEach(e=>{e.value||(e.value=v)}),d.forEach(e=>{e.addEventListener("change",function(e){const t=e.target.value;d.forEach(e=>{e.value=t})})}),s.addEventListener("change",async function(e){var t=e.target.files;if(0<t.length){t=t[0];new FileReader,new FileReader;if(t.type.startsWith("image")){const a=generateImageFilename();uploadChunkFile(t,a,function(){y("/media/tmp/"+a,a)}),e.target.value=""}}}),w(c,u),w(m,h),w(p,g),n.onclick=function(){var e,t,a,o,l=r.value;r.value&&""!==r.value.trim()&&(e=d[0].value,t=c[0].value,a=m[0].value,o=p[0].value,n.disabled=!0,loaderModalBusy(getTranslationBabel("Generation... Buttons are locked until finished. Tap on the screen to view details.")),fetchSendModuleDataImageComposition(f,l,e,t,a,o,M))},t.onclick=async function(){const t=o.querySelector(".image");if(t){let e=t.src;const a=generateImageFilename();(e="string"==typeof e?await urlToBlob(e):e)&&(console.log("download file"),uploadChunkFile(e,a,function(){sendModuleData.sourceFile={nameFile:a,urlFile:"/media/tmp/"+a,formatFile:"jpg",fileSizeBytes:null,naturalWidth:t.naturalWidth,naturalHeight:t.naturalHeight,offsetWidth:t.offsetWidth,offsetHeight:t.offsetHeight,startTime:null,endTime:null};var e=document.querySelector(".footer-preview");e instanceof HTMLImageElement&&(e.src="/media/tmp/"+a)}))}},l.onclick=function(){var e,t=o.querySelector(".image");t&&(t=t.src,(e=document.createElement("a")).href=t,e.download=generateImageFilename(),document.body.appendChild(e),e.click(),document.body.removeChild(e))},y(sendModuleData.sourceFile.urlFile,sendModuleData.sourceFile.nameFile),document.body.appendChild(e)}async function createModalOutpaint(){"ontouchstart"in window||navigator.msMaxTouchPoints;var e=document.querySelector(".modal-outpaint-template").content.cloneNode(!0);const o=e.querySelector(".modal-root"),r=o.querySelector(".modal-canvas"),t=o.querySelector(".modal-load-element");var a=o.querySelector(".aspect-ratio"),l=o.querySelector(".upload"),n=o.querySelector(".download");const i=1280,s=o.querySelector(".modal-outpaint-prompt"),d=o.querySelector(".resolution"),c=o.querySelector(".modal-outpaint-btn"),u=o.querySelectorAll(".modal-blur-factor");var m,h,p=o.querySelectorAll(".modal-blur-factor-slider");const g=document.createElement("div");g.classList.add("w-auto","max-w-full","object-contain","h-full","justify-center","flex"),g.style="border:1px #ffffff7a solid;background: rgb(234 234 234 / 8%);",r.appendChild(g);let f,v;const y=new Image;function b(e=null,t=!1){c.disabled=t,document.querySelectorAll(".aspect-ratio-btn").forEach(e=>{e.disabled=t}),e&&(y.src=e)}function w(e,t){var a=e/t;return e>i||t>i?1<a?{width:i,height:Math.ceil(i/a)}:{width:Math.ceil(i*a),height:i}:{width:Math.ceil(e),height:Math.ceil(t)}}if(sendModuleData.sourceFile.urlFile&&["jpg","jpeg","png","gif","bmp"].includes(sendModuleData.sourceFile.formatFile.toLowerCase())){{var M=sendModuleData.sourceFile.urlFile;if("string"==typeof M)M.startsWith("blob:"),y.src=M,y.setAttribute("default-src",M);else{if(!(M instanceof Blob||M instanceof File))return console.error("The src is not a valid string, Blob, or File"),null;M=URL.createObjectURL(M);y.src=M,y.setAttribute("default-src",M)}y.classList.add("w-auto","max-w-full","object-contain","h-full"),g.appendChild(y);let o=!1;y.onload=()=>{var e,t,a;o||(e=r.offsetWidth/r.offsetHeight,g.style.width=r.offsetWidth+"px",t=y.naturalWidth,a=y.naturalHeight,a=w((t=Math.max(t/e,a))*e,t),f=a.width,v=a.height,d.textContent=a.width+"x"+a.height,o=!0)}}l.onclick=async function(){const t=o.querySelector("img");if(t){let e=t.src;const a=generateImageFilename();(e="string"==typeof e?await urlToBlob(e):e)&&(console.log("download file"),uploadChunkFile(e,a,function(){sendModuleData.sourceFile={nameFile:a,urlFile:"/media/tmp/"+a,formatFile:"jpg",fileSizeBytes:null,naturalWidth:t.naturalWidth,naturalHeight:t.naturalHeight,offsetWidth:t.offsetWidth,offsetHeight:t.offsetHeight,startTime:null,endTime:null};var e=document.querySelector(".footer-preview");e instanceof HTMLImageElement&&(e.src="/media/tmp/"+a)}))}},n.onclick=function(){var e,t=o.querySelector("img");t&&(t=t.src,(e=document.createElement("a")).href=t,e.download=generateImageFilename(),document.body.appendChild(e),e.click(),document.body.removeChild(e))},m=u,h=p,m.forEach(e=>{e.addEventListener("change",function(){x(h,m,this)})}),h.forEach(e=>{e.addEventListener("input",function(){x(h,m,this)})}),a.appendChild(setAspectRatio(function(){y.src=y.getAttribute("default-src")||y.src;var e=r.offsetWidth/r.offsetHeight,t=sendModuleData.moduleParameters.aspectRatio,a=y.naturalWidth,o=y.naturalHeight,l=r.offsetWidth,n=r.offsetHeight;g.style.height="",v=(1<t?(g.style.width=t<e?l*(t/e)+"px":l+"px",g.offsetHeight>l/t&&(g.style.height=l/t+"px"),l=w((e=Math.max(a/t,o))*t,e),d.textContent=l.width+"x"+l.height,f=l.width,l):(g.style.width=n*t+"px",l=w(e=Math.max(o*t,a),e/t),d.textContent=l.width+"x"+l.height,f=l.width,l)).height})),c.onclick=function(){t.classList.remove("hidden");var e={blurFactor:u[0].value,positivePrompt:s.value,width:f,height:v};e.sourceImg=sendModuleData.sourceFile.urlFile,document.querySelectorAll(".aspect-ratio-btn").forEach(e=>{e.disabled=!0}),c.disabled=!0,fetchSendModuleDataOutpaint(e,b)},document.body.appendChild(e)}else console.error("This is not image.");function x(e,t,a){const o=Math.max(Math.min(a.value,a.max),a.min),l=Math.ceil((o-a.min)/(a.max-a.min)*100);e.forEach(e=>{e.value=o,e.style.setProperty("--fill-size",l+"%")}),t.forEach(e=>{e.value=o})}}async function createModalVisualRedraw(){"ontouchstart"in window||navigator.msMaxTouchPoints;var e=document.querySelector(".modal-redraw-template").content.cloneNode(!0);const l=e.querySelector(".modal-root"),i=l.querySelector(".modal-canvas"),t=l.querySelector(".modal-load-element");l.querySelector(".number-frames");var A=l.querySelector(".download"),j=l.querySelector(".upload");const a=l.querySelector(".modal-positive-prompt"),o=l.querySelector(".modal-negative-prompt");var H=l.querySelector(".inspire-button");const n=l.querySelector(".modal-img2img-btn"),r=l.querySelector(".modal-txt2img-btn"),s=l.querySelector(".modal-submit-btn"),d=l.querySelector(".brush-wheel");var O=l.querySelector(".clear-brush"),R=l.querySelector(".delete-button");const c=l.querySelector(".zoom-button"),u=l.querySelectorAll(".modal-seed"),m=l.querySelectorAll(".modal-strength");var W=l.querySelectorAll(".modal-strength-slider");const h=l.querySelectorAll(".modal-scale");var V=l.querySelectorAll(".modal-scale-slider");const p=l.querySelectorAll(".modal-control-strength");var N=l.querySelectorAll(".modal-control-strength-slider");const g=l.querySelectorAll(".modal-blur-factor");var U=l.querySelectorAll(".modal-blur-factor-slider");const f=document.createElement("canvas"),G=(f.classList.add("w-auto","max-w-full","absolute","h-full","z-[1]","opacity-0","group-hover:opacity-60","transition-opacity","full-opacity-on-touchscreen"),new Zooming);c.onclick=function(){f.classList.contains("hidden")?f.classList.remove("hidden"):f.classList.add("hidden"),this.classList.contains("bg-dark-elements")?(this.classList.add("hover:bg-accent-hover","text-dark-background","bg-accent-primary"),this.classList.remove("hover:bg-dark-elements-hover","text-light-primary","bg-dark-elements","!bg-dark-pop-up")):(this.classList.add("hover:bg-dark-elements-hover","text-light-primary","bg-dark-elements","!bg-dark-pop-up"),this.classList.remove("hover:bg-accent-hover","text-dark-background","bg-accent-primary"))};const $=sendModuleData.moduleParameters.seed||Math.floor(1000001*Math.random()),v=(u.forEach(e=>{e.value=$}),sendModuleData.moduleParameters.scale||7.5),y=(h.forEach(e=>{e.value=v}),V.forEach(e=>{e.value=v,elementFillSize=Math.ceil((e.value-e.min)/(e.max-e.min)*100),e.style.setProperty("--fill-size",elementFillSize+"%")}),sendModuleData.moduleParameters.strength||.75),b=(m.forEach(e=>{e.value=y}),W.forEach(e=>{e.value=y,elementFillSize=Math.ceil((e.value-e.min)/(e.max-e.min)*100),e.style.setProperty("--fill-size",elementFillSize+"%")}),sendModuleData.moduleParameters.controlStrength||.7),w=(p.forEach(e=>{e.value=b}),N.forEach(e=>{e.value=b,elementFillSize=Math.ceil((e.value-e.min)/(e.max-e.min)*100),e.style.setProperty("--fill-size",elementFillSize+"%")}),sendModuleData.moduleParameters.blurFactor||10);g.forEach(e=>{e.value=w}),U.forEach(e=>{e.value=w,elementFillSize=Math.ceil((e.value-e.min)/(e.max-e.min)*100),e.style.setProperty("--fill-size",elementFillSize+"%")});var M=(null==sendModuleData.sourceFile.urlFile?getRandomPrompt():"")||sendModuleData.moduleParameters.positivePrompt||"",x=(a.value=M,sendModuleData.moduleParameters.negativePrompt||"");o.value=x;let S={seed:$,strength:y,controlStrength:b,blurFactor:w,scale:v,positivePrompt:M,negativePrompt:x,sourceCanvas:null};i.appendChild(f);const P=f.getContext("2d",{willReadFrequently:!0});let k=!1,C=!1,E=_(),L=(d.style.color=`rgb(${E})`,25);const D=document.createElement("div");function F(e=!0){n.disabled=e,r.disabled=e,s.disabled=e}function T(e){var t=e.style.transform,a=e.style.transition;f.style.transform=t,f.style.transition=a,requestAnimationFrame(()=>T(e))}function q(e=null,t=!1){if(F(t),e){t=l.querySelector("img");if(t){const a=P.getImageData(0,0,f.width,f.height);t.src=e,t.onload=function(){P.putImageData(a,0,0)}}else{const o=new Image;o.src=e,o.setAttribute("default-src",e),o.classList.add("w-auto","max-w-full","object-contain","h-full"),i.appendChild(o),o.onload=()=>{f.width=o.width,f.height=o.height},handleZoomClick(o),G.listen(o),T(o)}}}if(D.classList.add("mouse-indicator","z-[2]"),i.appendChild(D),sendModuleData.sourceFile.urlFile&&["jpg","jpeg","png","gif","bmp"].includes(sendModuleData.sourceFile.formatFile.toLowerCase())){const z=new Image;M=sendModuleData.sourceFile.urlFile;if("string"==typeof M)M.startsWith("blob:"),z.src=M,z.setAttribute("default-src",M);else{if(!(M instanceof Blob||M instanceof File))return console.error("The src is not a valid string, Blob, or File"),null;x=URL.createObjectURL(M);z.src=x,z.setAttribute("default-src",x)}z.classList.add("w-auto","max-w-full","object-contain","h-full"),i.appendChild(z),z.onload=()=>{f.width=z.width,f.height=z.height},handleZoomClick(z),G.listen(z),T(z)}else{F(!0),t.classList.remove("hidden");M=sendModuleData.moduleParameters.aspectRatio;1<M?(S.width=1024,S.height=1024/M):(S.width=1024*M,S.height=1024),fetchSendModuleDataTxt2Img(S,q)}function _(){var e,t,a=[[255,77,0,100],[229,44,150,100],[200,237,210,100],[153,210,23,100],[0,143,255,100],[255,206,0,100]],o=a.length;return e=0,t=o,e=Math.ceil(e),t=Math.floor(t),a[(Math.floor(Math.random()*(t-e+1))+e)%o]}function B(e){var t,a,o;k&&(t=f.getBoundingClientRect(),o=f.width/t.width,a=f.height/t.height,o=(e.clientX-t.left)*o,e=(e.clientY-t.top)*a,P.lineWidth=L,P.lineCap="round",P.strokeStyle=`rgb(${E})`,P.lineTo(o,e),P.stroke(),P.beginPath(),P.moveTo(o,e))}function J(e){var t,a;C&&(t=f.getBoundingClientRect(),a=e.clientX-t.left,e=e.clientY-t.top,P.globalCompositeOperation="destination-out",P.beginPath(),P.arc(a,e,L/2,0,2*Math.PI),P.fill(),P.globalCompositeOperation="source-over")}function Z(e,t,a){const o=Math.max(Math.min(a.value,a.max),a.min),l=Math.ceil((o-a.min)/(a.max-a.min)*100);e.forEach(e=>{e.value=o,e.style.setProperty("--fill-size",l+"%")}),t.forEach(e=>{e.value=o})}function I(t,a){t.forEach(e=>{e.addEventListener("change",function(){Z(a,t,this)})}),a.forEach(e=>{e.addEventListener("input",function(){Z(a,t,this)})})}f.addEventListener("mousedown",e=>{0===e.button?(k=!0,C=!1,B(e)):2===e.button&&(C=!0,k=!1,J(e))}),f.addEventListener("mouseup",()=>{k=!1,C=!1,P.beginPath()}),f.addEventListener("mousemove",e=>{var t,a,o,l,n,r;t=e,a=i.offsetWidth,o=i.offsetHeight,l=f.getBoundingClientRect(),n=f.width/l.width,r=f.height/l.height,n=(t.clientX-l.left)*n,t=(t.clientY-l.top)*r,l=L,r=(a-f.width)/2+n-l/2,a=(o-f.height)/2+t-l/2,D.style.display="block",D.style.width=L+"px",D.style.height=L+"px",D.style.left=r+"px",D.style.top=a+"px",D.style.border="1px solid white",B(e),J(e)}),f.addEventListener("mouseleave",()=>{D.style.display="none"}),f.addEventListener("contextmenu",e=>{e.preventDefault()}),f.addEventListener("touchstart",e=>{e.preventDefault();e=e.touches[0];k=!0,B(e)}),f.addEventListener("touchend",()=>{k=!1,C=!1,P.beginPath()}),f.addEventListener("touchmove",e=>{B(e.touches[0])}),window.addEventListener("resize",()=>{var e=l.querySelector("img");e&&(f.style.width=e.width,f.style.height=e.height)}),u.forEach(e=>{e.addEventListener("change",function(e){const t=e.target.value;u.forEach(e=>{e.value=t})})}),I(m,W),I(h,V),I(p,N),I(g,U),H.onclick=function(){a.value=getRandomPrompt()},j.onclick=async function(){var e=document.createElement("input");e.type="file",e.accept=".png, .jpg, .jpeg",e.click(),e.onchange=function(e){var t,e=e.target.files[0];e&&((t=new FileReader).onload=function(e){const t=l.querySelector("img");t&&(t.src=e.target.result,t.onload=()=>{f.width=t.width,f.height=t.height})},t.readAsDataURL(e))}},n.onclick=async function(){var e;0<a.value.length?(a.parentElement.classList.remove("border-danger-primary","border"),loaderModalBusy(getTranslationBabel("Generation... Buttons are locked until finished. Tap on the screen to view details.")),t.classList.remove("hidden"),(e=l.querySelector("img"))&&(S.sourceImg=e.src),S.positivePrompt=a.value,S.negativePrompt=o.value,S.seed=u[0].value,S.strength=m[0].value,S.scale=h[0].value,S.controlStrength=p[0].value,S.blurFactor=g[0].value,S.sourceCanvas=await saveCanvasAsJPEG(f,e.naturalWidth,e.naturalHeight),F(!0),await fetchSendModuleDataInpaint(S,q)):a.parentElement.classList.add("border-danger-primary","border")},R.onclick=function(){const e=l.querySelector("img");if(e){var t=e.getAttribute("default-src");if(t){const a=P.getImageData(0,0,f.width,f.height);e.src=t,e.onload=function(){P.putImageData(a,0,0),f.width===e.width&&f.height===e.height||(f.width=e.width,f.height=e.height)}}}},O.onclick=function(){var e=l.querySelector("img");e&&(f.width=e.width,f.height=e.height,P.clearRect(0,0,f.width,f.height))},d.addEventListener("contextmenu",function(e){e.preventDefault(),2===e.button&&(E=_(),d.style.color=`rgb(${E})`)}),d.addEventListener("mousedown",function(e){f.classList.remove("hidden"),0===e.button&&(1.4<.1+(e=parseFloat(window.getComputedStyle(this).fontSize)/16)?(this.style.fontSize="0.5rem",L=5):(this.style.fontSize=.1+e+"rem",L+=5)),c.classList.contains("bg-accent-primary")&&(c.classList.add("hover:bg-dark-elements-hover","text-light-primary","bg-dark-elements","!bg-dark-pop-up"),c.classList.remove("hover:bg-accent-hover","text-dark-background","bg-accent-primary"))}),A.onclick=function(){var e,t=l.querySelector("img");t&&(t=t.src,(e=document.createElement("a")).href=t,e.download=generateImageFilename(),document.body.appendChild(e),e.click(),document.body.removeChild(e))},r.onclick=function(){F(!0),S.positivePrompt=a.value,S.negativePrompt=o.value,S.seed=u[0].value,S.strength=m[0].value,S.scale=h[0].value;var e=sendModuleData.moduleParameters.aspectRatio;1<e?(S.width=1024,S.height=1024/e):(S.width=1024*e,S.height=1024),t.classList.remove("hidden"),fetchSendModuleDataTxt2Img(S,q)},s.onclick=async function(){var e=l.querySelector("img");sendModuleData.sourceFile.urlFile=e.src,sendModuleData.sourceFile.formatFile="jpg",sendModuleData.moduleParameters.positivePrompt=a.value,sendModuleData.moduleParameters.negativePrompt=o.value,sendModuleData.moduleParameters.seed=u[0].value,sendModuleData.moduleParameters.strength=m[0].value,sendModuleData.moduleParameters.scale=h[0].value,closeModal(this)},document.body.appendChild(e)}async function saveCanvasAsJPEG(e,t,a,o=.8){var l=generateImageFilename(),n=!e.getContext("2d").getImageData(0,0,e.width,e.height).data.some(e=>0!==e),r=document.createElement("canvas"),i=(r.width=t,r.height=a,r.getContext("2d"));n?(i.fillStyle="white",i.fillRect(0,0,t,a),console.log("Canvas is empty. Saving a black image.")):i.drawImage(e,0,0,t,a);let s=r.toDataURL("image/jpeg",o);return(s="string"==typeof s?await urlToBlob(s):s)&&(console.log("download file"),uploadChunkFile(s,l)),l}function setParametersButtonGeneration(){var e=document.querySelector(".footer-parameters").querySelector("div"),t=(e.classList.remove("mt-3"),e.innerHTML="",document.createElement("div")),a=(t.classList.add("flex","gap-3","items-center","justify-between"),document.createElement("p"));a.classList.add("font-extra-thick","underline","text-accent-primary","question","group"),a.innerHTML=`${getTranslationBabel("Style")}<div class="bg-dark-pop-up bg-opacity-50 backdrop-blur-2xl absolute bottom-full -translate-y-1 left-1/2 -translate-x-1/2 lg:text-s text-s-mobile px-1.5 py-1 rounded-md after:absolute after:top-full after:left-1/2 after:-translate-x-1/2 after:border-t-[5px] after:border-x-[3px] after:border-x-transparent after:border-t-dark-elements hidden hidden-on-touchscreen group-hover:block whitespace-nowrap">${getTranslationBabel("Add a new custom Stable Diffusion 1.5 model to the configuration file located at")} <code>./wunjo/all_models/custom_diffusion.json</code>.</div>`;const r=document.createElement("div");r.classList.add("grid-cols-2","gap-5","grid","overflow-auto"),r.style.maxHeight="6.9rem";let i=0;sdModels.forEach(e=>{if(e.hasOwnProperty("model")){var t=document.createElement("div");t.classList.add("group","flex","flex-col","justify-center","items-center","text-center");const n=document.createElement("button");n.classList.add("model-picker","w-[5.625rem]","h-[5.625rem]","rounded-md","opacity-60","group-hover:opacity-100","transition-all"),n.type="button";var a=document.createElement("p");a.classList.add("w-[5.625rem]"),a.style="white-space: nowrap;overflow: hidden;text-overflow: ellipsis;",e.hasOwnProperty("name")?a.textContent=e.name:a.textContent=(o=e.model)?(l=o.lastIndexOf("."),o.substring(0,l).replace(/_/g," ").toLowerCase().replace(/^\w/,e=>e.toUpperCase())):"Unknown",sendModuleData.moduleParameters.sdModel?sendModuleData.moduleParameters.sdModel===e.model&&(n.classList.remove("opacity-60"),n.style.border="2px solid white"):0===i&&(n.classList.remove("opacity-60"),n.style.border="2px solid white",sendModuleData.moduleParameters.sdModel=e.model),e.hasOwnProperty("img")?n.style.backgroundImage=`url(${e.img})`:n.style.backgroundColor="#0d0d0d",n.style.backgroundSize="cover",n.style.backgroundPosition="center",n.onclick=function(){r.querySelectorAll(".model-picker").forEach(e=>{e.classList.add("opacity-60"),e.style.border=""}),this.classList.remove("opacity-60"),this.style.border="2px solid white";var e=n.getAttribute("model");sendModuleData.moduleParameters.sdModel=e},e.hasOwnProperty("url")&&(n.title=e.url),n.setAttribute("model",e.model),t.appendChild(n),t.appendChild(a),r.appendChild(t),i++}var o,l}),t.appendChild(a),e.append(t,r)}function setModuleImgButtons(){var e=[],t=setbuttonOutpaint(),a=setbuttonImageComposition();return e.push(t,a),e}function setbuttonOutpaint(){var e=document.createElement("div"),t=(e.classList.add("relative","group"),document.createElement("div")),a=(t.classList.add("hidden","absolute","p-2","group-hover:flex","items-center","gap-3","bottom-full","left-1/2","-translate-x-1/2","-translate-y-3.5","bg-dark-elements-hover","rounded-md","w-[300px]"),document.createElement("img")),o=(a.classList.add("w-20","h-20","rounded-md"),a.src="/static/modules/thumbnail/select_text.png",a.alt="Complete the image",a.width=256,a.height=256,document.createElement("span")),l=(o.classList.add("text-m-mobile","lg:text-m"),o.style="display: inline-block; vertical-align: top; text-decoration: inherit; text-wrap: balance;",o.textContent=getTranslationBabel("Ready to have some fun? Complete the image and add new elements."),document.createElement("div")),n=(l.classList.add("module-button-div","relative","flex","gap-2","items-center","rounded-md","bg-light-emphasis"),document.createElement("button")),r=(n.classList.add("outpaint-button","stroke-light-primary","text-light-primary","relative","flex","gap-2","items-center","group","py-1.5","pl-2","whitespace-nowrap","font-extra-thick","pr-2"),n.type="button",n.innerHTML='<svg class="transition-[fill,opacity] opacity-60 group-hover:opacity-100" width="20px" height="20px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g stroke-width="0"></g><g stroke-linecap="round" stroke-linejoin="round"></g><g > <path d="M13.9922 17H16.9922M19.9922 17H16.9922M16.9922 17V14M16.9922 17V20" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M4 9.4V4.6C4 4.26863 4.26863 4 4.6 4H9.4C9.73137 4 10 4.26863 10 4.6V9.4C10 9.73137 9.73137 10 9.4 10H4.6C4.26863 10 4 9.73137 4 9.4Z" stroke-width="1.5"></path> <path d="M4 19.4V14.6C4 14.2686 4.26863 14 4.6 14H9.4C9.73137 14 10 14.2686 10 14.6V19.4C10 19.7314 9.73137 20 9.4 20H4.6C4.26863 20 4 19.7314 4 19.4Z" stroke-width="1.5"></path> <path d="M14 9.4V4.6C14 4.26863 14.2686 4 14.6 4H19.4C19.7314 4 20 4.26863 20 4.6V9.4C20 9.73137 19.7314 10 19.4 10H14.6C14.2686 10 14 9.73137 14 9.4Z" stroke-width="1.5"></path> </g></svg>',document.createElement("span"));return r.textContent="Outpaint",n.onclick=function(){document.querySelector(".footer-preview")&&createModalOutpaint()},n.appendChild(r),t.appendChild(a),t.appendChild(o),l.appendChild(n),e.appendChild(t),e.appendChild(l),e}function setbuttonImageComposition(){var e=document.createElement("div"),t=(e.classList.add("relative","group"),document.createElement("div")),a=(t.classList.add("hidden","absolute","p-2","group-hover:flex","items-center","gap-3","bottom-full","left-1/2","-translate-x-1/2","-translate-y-3.5","bg-dark-elements-hover","rounded-md","w-[300px]"),document.createElement("img")),o=(a.classList.add("w-20","h-20","rounded-md"),a.src="/static/modules/thumbnail/select_text.png",a.alt="Images to composition",a.width=256,a.height=256,document.createElement("span")),l=(o.classList.add("text-m-mobile","lg:text-m"),o.style="display: inline-block; vertical-align: top; text-decoration: inherit; text-wrap: balance;",o.textContent=getTranslationBabel("Create photos from images and a prompt. Modify age, environment, and characters while preserving identity with realism."),document.createElement("div")),n=(l.classList.add("module-button-div","relative","flex","gap-2","items-center","rounded-md","bg-light-emphasis"),document.createElement("button")),r=(n.classList.add("outpaint-button","stroke-light-primary","text-light-primary","relative","flex","gap-2","items-center","group","py-1.5","pl-2","whitespace-nowrap","font-extra-thick","pr-2"),n.type="button",n.innerHTML='<svg fill="white" class="transition-[fill,opacity] opacity-60 group-hover:opacity-100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  width="18px" height="18px" viewBox="0 0 512 512" xml:space="preserve"><g><path class="st0" d="M99.281,399.469h320.094c6.172,0,11.844-3.422,14.719-8.875c2.844-5.469,2.438-12.078-1.063-17.141 l-69.156-100.094c-6.313-9.125-16.781-14.516-27.906-14.297s-21.406,5.969-27.375,15.359l-19.719,30.984l-54.828-79.359 c-6.313-9.172-16.797-14.531-27.922-14.328s-21.406,5.969-27.375,15.359L85.281,373.984c-3.25,5.109-3.469,11.578-0.531,16.875 C87.656,396.172,93.219,399.469,99.281,399.469z"/><path class="st0" d="M322.672,223.906c23.688,0,42.922-19.219,42.922-42.922c0-23.688-19.234-42.906-42.922-42.906 c-23.703,0-42.922,19.219-42.922,42.906C279.75,204.688,298.969,223.906,322.672,223.906z"/><path class="st0" d="M0,19.703v472.594h512v-25.313V19.703H0z M461.375,441.672H50.625V70.328h410.75V441.672z"/></g></svg>',document.createElement("span"));return r.textContent=getTranslationBabel("Image composition"),n.onclick=function(){document.querySelector(".footer-preview")&&createModalImageComposition()},n.appendChild(r),t.appendChild(a),t.appendChild(o),l.appendChild(n),e.appendChild(t),e.appendChild(l),e}function setMetaButtonGeneration(){var e=document.querySelector(".footer-parameters").querySelector("div"),t=(e.innerHTML="",sendModuleData.moduleParameters.nameFile),t=createGeneralTextInput({label:getTranslationBabel("Filename"),defaultValue:t,disableStatus:!1,onChange:e=>{var t=event.target.value;/^[a-zA-Z0-9-]*$/.test(t)||(event.target.value=t.slice(0,-1)),sendModuleData.moduleParameters.nameFile=e}})["wrapper"];e.appendChild(t)}async function fetchSendModuleDataInpaint(l,n=null){(async()=>{let e=l.sourceImg;var t=l.sourceCanvas,a=generateImageFilename();"string"==typeof e&&(e=await urlToBlob(e)),uploadChunkFile(e,a),l.sourceImg=null,l.positivePrompt=await translateText(l.positivePrompt,"en","auto"),l.negativePrompt=await translateText(l.negativePrompt,"en","auto");const o={method:moduleInpaintName,filename:a,canvasFileName:t,sdModel:sendModuleData.moduleParameters.sdModel||getCustomRandomModel(),diffusionParameters:l};console.log(JSON.stringify(o,null,4)),await fetch("/submit-cpu-task",{method:"POST",body:JSON.stringify(o),headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{if(200===e.status){const t=e.id;setTimeout(()=>{getEventWithInterval(t,n)},1e3)}else loaderModalWarn("Something wrong..."+e.message)}).catch(e=>{loaderModalError(getTranslationBabel("Something wrong...During create task. Tap on the screen to view details."))})})()}async function fetchSendModuleDataImageComposition(a,o,l,n,r,i,s=null){(async()=>{var e=generateImageFilename();o=await translateText(o,"en","auto");const t={method:moduleImageCompositionName,filename:e,width:r,height:i,prompt:o.toLowerCase(),seed:l,scale:n,inputImages:a};console.log(JSON.stringify(t,null,4)),await createConnection(async function(){await fetch("/submit-cpu-task",{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{if(200===e.status){const t=e.id;setTimeout(()=>{getEventWithInterval(t,s)},1e3)}else loaderModalWarn("Something wrong..."+e.message)}).catch(e=>{loaderModalError(getTranslationBabel("Something wrong...During create task. Tap on the screen to view details."))})},function(){loaderModalWarn(getTranslationBabel("Authorization failed. Access is available only with a subscription. Please review available plans and any discounts."))},!1,!1)})()}async function fetchSendModuleDataOutpaint(r,i=null){(async()=>{let e=r.sourceImg;var t=generateImageFilename(),a=("string"==typeof e&&(e=await urlToBlob(e)),uploadChunkFile(e,t),r.sourceImg=null,r.positivePrompt=await translateText(r.positivePrompt,"en","auto"),r.negativePrompt=await translateText(r.negativePrompt,"en","auto"),r.blurFactor),o=r.width,l=r.height;const n={method:moduleOutpaintName,filename:t,width:o,height:l,blurFactor:a,sdModel:sendModuleData.moduleParameters.sdModel||getCustomRandomModel(),diffusionParameters:r};console.log(JSON.stringify(n,null,4)),await fetch("/submit-cpu-task",{method:"POST",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{if(200===e.status){const t=e.id;setTimeout(()=>{getEventWithInterval(t,i)},1e3)}else loaderModalWarn("Something wrong..."+e.message)}).catch(e=>{loaderModalError(getTranslationBabel("Something wrong...During create task. Tap on the screen to view details."))})})()}async function fetchSendModuleDataTxt2Img(o,l=null){(async()=>{o.sourceImg=null;var e=o.width,t=o.height;o.positivePrompt=await translateText(o.positivePrompt,"en","auto"),o.negativePrompt=await translateText(o.negativePrompt,"en","auto");const a={method:moduleText2ImgName,sdModel:sendModuleData.moduleParameters.sdModel||getCustomRandomModel(),width:e,height:t,diffusionParameters:o};console.log(JSON.stringify(a,null,4)),await fetch("/submit-cpu-task",{method:"POST",body:JSON.stringify(a),headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{if(200===e.status){const t=e.id;setTimeout(()=>{getEventWithInterval(t,l)},1e3)}else loaderModalWarn("Something wrong..."+e.message)}).catch(e=>{loaderModalError(getTranslationBabel("Something wrong...During create task. Tap on the screen to view details."))})})()}async function fetchSendModuleDataVideoGeneration(){""===sendModuleData.moduleParameters.nameFile.trim()&&(sendModuleData.moduleParameters.nameFile=generateUUID()),sendModuleData.moduleParameters.positivePrompt&&""!==sendModuleData.moduleParameters.positivePrompt.trim()||(sendModuleData.moduleParameters.positivePrompt=getRandomPrompt());var e=sendModuleData.sourceFile.formatFile&&["jpg","jpeg","png","gif","bmp"].includes(sendModuleData.sourceFile.formatFile.toLowerCase())?{tmpFileName:generateImageFilename(),validMessage:""}:sendModuleData.sourceFile.formatFile?{tmpFileName:!1,validMessage:getTranslationBabel("Is not valid format.")}:{tmpFileName:!0,validMessage:getTranslationBabel("Image will be generate.")},t=e.tmpFileName,e=e.validMessage;if(sendModuleData.moduleParameters.positivePrompt=await translateText(sendModuleData.moduleParameters.positivePrompt,"en","auto"),sendModuleData.moduleParameters.negativePrompt=await translateText(sendModuleData.moduleParameters.negativePrompt,"en","auto"),t&&sendModuleData.sourceFile.formatFile){if(!sendModuleData.sourceFile.urlFile)return{statusBool:!1,validMessage:e};async function a(){console.log(JSON.stringify(sendModuleData,null,4)),await postModuleTaskEvent(sendModuleData),sendModuleData.moduleParameters.nameFile=generateUUID()}sendModuleData.sourceFile.nameFile=sendModuleData.sourceFile.urlFile.split("/").pop(),await createConnection(a)}else{if(!t||sendModuleData.sourceFile.formatFile)return{statusBool:!1,validMessage:e};{async function a(){console.log(JSON.stringify(sendModuleData,null,4)),await postModuleTaskEvent(sendModuleData),sendModuleData.moduleParameters.nameFile=generateUUID()}await createConnection(a)}}return{statusBool:!0,validMessage:e}}const getEventWithInterval=async(e,a=null)=>{const o=setInterval(async()=>{await fetch("/query-cpu-task/"+e,{method:"GET",headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{if(200===e.status){if(clearInterval(o),!e.response)return loaderModalWarn(getTranslationBabel("Oops! Something went wrong. Please click submit again after some time. Tap on the screen to view details.")),void(a&&"function"==typeof a&&a(null,!1));var t=e.response.filename;a&&"function"==typeof a&&a(t),loaderModalHidden()}else 300===e.status||404===e.status?(clearInterval(o),loaderModalWarn(e.message),a&&"function"==typeof a&&a(null,!1)):loaderModalBusy(`${e.progress_message} ${e.progress}%`)}).catch(e=>{clearInterval(o),loaderModalError(getTranslationBabel("Oops! An unexpected error occurred. Tap on the screen to view details.")),a&&"function"==typeof a&&a(null,!0)})},3e3)};function setLiteSetting(){var e=document.querySelector(".system-processor")||null;e&&e.remove();const t=getTranslationBabel("generation");e=document.querySelector("#settings");e.href="",e.onclick=async function(){event.preventDefault(),createModalLiteSetting(t,"VIDEO_DIFFUSER",1080)}}function openDownloadModelsNotificationModal(){var e=document.querySelector(".modal-download-models-notification-template").content.cloneNode(!0);e.querySelectorAll(".generation").forEach(e=>{e.classList.remove("hidden")}),document.body.appendChild(e)}setLiteSetting(),downloadModels&&openDownloadModelsNotificationModal(),createFooterFile(callbacks,["text","image"]);