function fetchYamlData(e){return fetch(e).then(e=>!!e.ok&&e.text()).then(e=>{e=jsyaml.load(e);return!!e&&(openFileParametersModal(e),!0)}).catch(e=>(console.error("Error loading YAML:",e),!1))}function createViewVideo(o,e,t=null){var n=new IntersectionObserver((e,t)=>{e.forEach(e=>{var t=e.target.querySelector("video");t&&(e.isIntersecting?t.classList.remove("hidden"):t.classList.add("hidden"))})},{root:null,rootMargin:"0px",threshold:.5}),r="ontouchstart"in window||navigator.msMaxTouchPoints,a=document.querySelector(".view-video-template").content.cloneNode(!0);const c=a.querySelector(".view-root");getFileMetadataDate(e.created);c.setAttribute("data-date",formatDateTime(e.created)),c.setAttribute("data-path",o);const i=c.querySelector(".video");if(i.classList.add("hidden"),i.src=o,"IntersectionObserver"in window){const x=new IntersectionObserver(function(e,t){e.forEach(function(e){e.isIntersecting&&((e=e.target).querySelectorAll("source").forEach(e=>{e.src=e.dataset.src}),e.load(),x.unobserve(e))})});x.observe(i)}else i.load();const l=c.querySelector(".download");l.href=o,l.download=e.name;var s=new URL(window.location.href);s.origin,s.pathname;const d={[getTranslationBabel("Live portrait")]:"/live-portrait",[getTranslationBabel("Face swap")]:"/face-swap",[getTranslationBabel("Lip sync")]:"/lip-sync",[getTranslationBabel("Enhancement")]:"/enhancement",[getTranslationBabel("Remove object")]:"/remove-object",[getTranslationBabel("Remove background")]:"/remove-background",[getTranslationBabel("Restyling")]:"/restyling"};var s=Object.keys(d),u=c.querySelector(".edit-input");const m=new Awesomplete(u,{list:s,minChars:0,maxItems:10}),v=(u.addEventListener("focus",function(){m.evaluate(),m.open()}),m.ul.style.maxHeight="10rem",m.ul.style.maxWidth="20px",m.ul.style.overflowX="hidden",u.addEventListener("awesomplete-selectcomplete",async function(e){e.text.value in d&&(e=d[e.text.value],window.location.href=e+"?attachment="+o)}),c.querySelector(".censure"));function h(){v.querySelector(".fa-eye").classList.toggle("hidden"),v.querySelector(".fa-eye-slash").classList.toggle("hidden"),i.style.filter=i.style.filter?"":"blur(50px)"}!0===e.censure?(h(),v.onclick=h):v.classList.add("hidden");const p=c.querySelector(".description");s=c.querySelector(".datetime-created");const f=c.querySelector(".fps"),y=c.querySelector(".duration"),w=c.querySelector(".burger-list"),g=c.querySelector(".parameters"),S=c.querySelector(".close-parameters-view"),q=document.querySelector(".modal-view-video-suggest");u=c.querySelector(".suggest-button");function b(e){var t=c.querySelector(".open-burger-button"),e=e.target;w.contains(e)||t.contains(e)||(w.classList.add("hidden"),document.removeEventListener("click",b))}function k(e){var t=c.querySelector(".open-parameters-view"),e=e.target;g.contains(e)||t.contains(e)||S.click()}function L(e){return Math.floor(e/60)+":"+Math.floor(e%60).toString().padStart(2,"0")}return q&&u.parentElement.classList.remove("hidden"),p.textContent=e.name,s.textContent=formatDateTime(e.created),c.querySelector(".repost-button").onclick=function(){var e=o,t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),t.setSelectionRange(0,t.value.length),document.execCommand("copy"),document.body.removeChild(t)},u.onclick=function(){var e;q&&((e=q.content.cloneNode(!0)).querySelectorAll("a").forEach(e=>{e.href+=o}),document.body.appendChild(e))},c.querySelector(".open-video-modal-button").onclick=function(){createModalVideo(o,e,t)},c.querySelector(".copy-description-button").onclick=function(){var e=p.textContent,t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),t.setSelectionRange(0,t.value.length),document.execCommand("copy"),document.body.removeChild(t)},c.querySelector(".rename-button").onclick=function(){openRenameNoticeModal(o,t).then(e=>{p.textContent=e.newFileName;var t=createStaticSrc(e.srcFilePath,e.newFileName);o=t,i.src=t,l.href=t,l.download=e.newFileName}).catch(e=>{})},c.querySelector(".delete-button").onclick=function(){openDeleteNoticeModal(o,t).then(e=>{!0===e&&c.remove()}).catch(e=>{console.error("Error:",e)})},c.querySelector(".open-burger-button").onclick=function(){w.classList.remove("hidden"),setTimeout(()=>{document.addEventListener("click",b)},100)},c.querySelector(".open-parameters-view").onclick=function(){fetchYamlData(o.replace(/\.[^/.]+$/,".yaml")).then(e=>{e||(g.classList.remove("hidden"),g.classList.add("block"),setTimeout(()=>{document.addEventListener("click",k)},100))})},S.onclick=function(){g.classList.remove("block"),g.classList.add("hidden"),document.removeEventListener("click",k)},r?c.querySelector(".touchscreen-play").addEventListener("click",function(){i.paused?(i.play(),this.classList.add("opacity-0")):(i.pause(),this.classList.remove("opacity-0"))}):(i.addEventListener("mouseover",function(){y.classList.remove("opacity-0"),y.classList.add("opacity-100"),i.play().catch(e=>{console.log(e)})}),i.addEventListener("mouseout",function(){y.classList.remove("opacity-100"),y.classList.add("opacity-0"),i.pause()})),i.addEventListener("loadedmetadata",function(){i.pause(),i.muted=!0;var e,t=L(i.duration);y.textContent="0:00/"+t,f&&i.webkitDecodedFrameCount&&i.webkitDroppedFrameCount&&(t=i.webkitDecodedFrameCount/i.duration,e=i.webkitDroppedFrameCount/i.duration,f.textContent=`Decoded FPS: ${t.toFixed(2)}, Dropped FPS: `+e.toFixed(2))}),i.addEventListener("error",e=>(console.error("Error loading video:",e),c.remove(),null)),i.addEventListener("timeupdate",function(){var e=L(i.currentTime),t=L(i.duration);y.textContent=e+"/"+t}),"IntersectionObserver"in window&&n.observe(c),a}function createViewVideoStatic(o,e,t=null){var n="ontouchstart"in window||navigator.msMaxTouchPoints,r=document.querySelector(".view-video-template").content.cloneNode(!0);const a=r.querySelector(".view-root");getFileMetadataDate(e.created);a.setAttribute("data-date",formatDateTime(e.created)),a.setAttribute("data-path",o);const c=a.querySelector(".video"),i=(c.classList.add("hidden"),c.src=o,c.muted=!0,new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(c.src=c.dataset.src,i.unobserve(c))})}));i.observe(c);var l=c.parentElement;const s=document.createElement("img"),d=(s.classList.add("w-auto","h-full","object-contain"),l.appendChild(s),c.addEventListener("loadedmetadata",function(){c.currentTime=0}),c.addEventListener("seeked",function(){var e=document.createElement("canvas");e.width=c.videoWidth,e.height=c.videoHeight,e.getContext("2d").drawImage(c,0,0,e.width,e.height),s.src=e.toDataURL("image/png"),s.classList.remove("hidden"),c.remove()}),a.querySelector(".download"));d.href=o,d.download=e.name;l=new URL(window.location.href);l.origin,l.pathname;const u={[getTranslationBabel("Live portrait")]:"/live-portrait",[getTranslationBabel("Face swap")]:"/face-swap",[getTranslationBabel("Lip sync")]:"/lip-sync",[getTranslationBabel("Enhancement")]:"/enhancement",[getTranslationBabel("Remove object")]:"/remove-object",[getTranslationBabel("Remove background")]:"/remove-background",[getTranslationBabel("Restyling")]:"/restyling"};var l=Object.keys(u),m=a.querySelector(".edit-input");const v=new Awesomplete(m,{list:l,minChars:0,maxItems:10}),h=(m.addEventListener("focus",function(){v.evaluate(),v.open()}),v.ul.style.maxHeight="10rem",v.ul.style.maxWidth="20px",v.ul.style.overflowX="hidden",v.input.classList.remove("w-14"),v.input.classList.add("w-32"),m.addEventListener("awesomplete-selectcomplete",async function(e){e.text.value in u&&(e=u[e.text.value],window.location.href=e+"?attachment="+o)}),a.querySelector(".censure"));function p(){h.querySelector(".fa-eye").classList.toggle("hidden"),h.querySelector(".fa-eye-slash").classList.toggle("hidden"),s.style.filter=s.style.filter?"":"blur(50px)"}!0===e.censure?(p(),h.onclick=p):h.classList.add("hidden");const f=a.querySelector(".description");l=a.querySelector(".datetime-created");a.querySelector(".fps"),a.querySelector(".duration");const y=a.querySelector(".burger-list"),w=a.querySelector(".parameters"),g=a.querySelector(".close-parameters-view"),S=document.querySelector(".modal-view-video-suggest");m=a.querySelector(".suggest-button");function q(e){var t=a.querySelector(".open-burger-button"),e=e.target;y.contains(e)||t.contains(e)||(y.classList.add("hidden"),document.removeEventListener("click",q))}function b(e){var t=a.querySelector(".open-parameters-view"),e=e.target;w.contains(e)||t.contains(e)||g.click()}return S&&m.parentElement.classList.remove("hidden"),f.textContent=e.name,l.textContent=formatDateTime(e.created),a.querySelector(".repost-button").onclick=function(){var e=o,t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),t.setSelectionRange(0,t.value.length),document.execCommand("copy"),document.body.removeChild(t)},m.onclick=function(){var e;S&&((e=S.content.cloneNode(!0)).querySelectorAll("a").forEach(e=>{e.href+=o}),document.body.appendChild(e))},a.querySelector(".open-video-modal-button").onclick=function(){createModalVideo(o,e,t)},n&&(a.querySelector(".touchscreen-play").onclick=function(){createModalVideo(o,e,t)}),a.querySelector(".copy-description-button").onclick=function(){var e=f.textContent,t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),t.setSelectionRange(0,t.value.length),document.execCommand("copy"),document.body.removeChild(t)},a.querySelector(".rename-button").onclick=function(){openRenameNoticeModal(o,t).then(e=>{f.textContent=e.newFileName;var t=createStaticSrc(e.srcFilePath,e.newFileName);o=t,s.src=t,d.href=t,d.download=e.newFileName}).catch(e=>{console.error("Error:",e)})},a.querySelector(".delete-button").onclick=function(){openDeleteNoticeModal(o,t).then(e=>{!0===e&&a.remove()}).catch(e=>{console.error("Error:",e)})},a.querySelector(".open-burger-button").onclick=function(){y.classList.remove("hidden"),setTimeout(()=>{document.addEventListener("click",q)},100)},a.querySelector(".open-parameters-view").onclick=function(){fetchYamlData(o.replace(/\.[^/.]+$/,".yaml")).then(e=>{e||(w.classList.remove("hidden"),w.classList.add("block"),setTimeout(()=>{document.addEventListener("click",b)},100))})},g.onclick=function(){w.classList.remove("block"),w.classList.add("hidden"),document.removeEventListener("click",b)},r}function createViewImage(o,e,t=null){var n=document.querySelector(".view-image-template").content.cloneNode(!0);const r=n.querySelector(".view-root");getFileMetadataDate(e.created);r.setAttribute("data-date",formatDateTime(e.created)),r.setAttribute("data-path",o);const a=r.querySelector(".burger-list"),c=document.querySelector(".modal-view-image-suggest");var i=r.querySelector(".suggest-button");c&&i.parentElement.classList.remove("hidden");const l=r.querySelector(".image"),s=(l.src=o,r.querySelector(".censure"));function d(){s.querySelector(".fa-eye").classList.toggle("hidden"),s.querySelector(".fa-eye-slash").classList.toggle("hidden"),l.style.filter=l.style.filter?"":"blur(50px)"}!0===e.censure?(d(),s.onclick=d):s.classList.add("hidden");const u=r.querySelector(".download");u.href=o,u.download=e.name;var m=new URL(window.location.href);m.origin,m.pathname;const v={[getTranslationBabel("Live portrait")]:"/live-portrait",[getTranslationBabel("Face swap")]:"/face-swap",[getTranslationBabel("Lip sync")]:"/lip-sync",[getTranslationBabel("Enhancement")]:"/enhancement",[getTranslationBabel("Remove object")]:"/remove-object",[getTranslationBabel("Remove background")]:"/remove-background",[getTranslationBabel("Generation")]:"/generation",[getTranslationBabel("Restyling")]:"/restyling"};var m=Object.keys(v),h=r.querySelector(".edit-input");const p=new Awesomplete(h,{list:m,minChars:0,maxItems:10}),f=(h.addEventListener("focus",function(){p.evaluate(),p.open()}),p.ul.style.maxHeight="10rem",p.ul.style.maxWidth="20px",p.ul.style.overflowX="hidden",p.input.classList.remove("w-14"),p.input.classList.add("w-32"),h.addEventListener("awesomplete-selectcomplete",async function(e){e.text.value in v&&(e=v[e.text.value],window.location.href=e+"?attachment="+o)}),r.querySelector(".description"));m=r.querySelector(".datetime-created");function y(e){var t=r.querySelector(".open-parameters-view"),o=r.querySelector(".parameters"),e=e.target;o.contains(e)||t.contains(e)||r.querySelector(".close-parameters-view").click()}function w(e){var t=r.querySelector(".open-burger-button"),e=e.target;a.contains(e)||t.contains(e)||(a.classList.add("hidden"),document.removeEventListener("click",w))}return f.textContent=e.name,m.textContent=formatDateTime(e.created),r.querySelector(".repost-button").onclick=function(){var e=o,t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),t.setSelectionRange(0,t.value.length),document.execCommand("copy"),document.body.removeChild(t)},r.querySelector(".open-image-modal-button").onclick=function(){createModalImage(o,e,t)},r.querySelector(".copy-description-button").onclick=function(){var e=f.textContent,t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),t.setSelectionRange(0,t.value.length),document.execCommand("copy"),document.body.removeChild(t)},r.querySelector(".rename-button").onclick=function(){openRenameNoticeModal(o,t).then(e=>{f.textContent=e.newFileName;var t=createStaticSrc(e.srcFilePath,e.newFileName);o=t,l.src=t,u.href=t,u.download=e.newFileName}).catch(e=>{})},r.querySelector(".delete-button").onclick=function(){openDeleteNoticeModal(o,t).then(e=>{!0===e&&r.remove()}).catch(e=>{console.error("Error:",e)})},i.onclick=function(){var e;c&&((e=c.content.cloneNode(!0)).querySelectorAll("a").forEach(e=>{e.href+=o}),document.body.appendChild(e))},r.querySelector(".open-burger-button").onclick=function(){a.classList.remove("hidden"),setTimeout(()=>{document.addEventListener("click",w)},100)},r.querySelector(".open-parameters-view").onclick=function(){fetchYamlData(o.replace(/\.[^/.]+$/,".yaml")).then(e=>{e||(parametersView.classList.remove("hidden"),parametersView.classList.add("block"),setTimeout(()=>{document.addEventListener("click",y)},100))})},r.querySelector(".close-parameters-view").onclick=function(){var e=r.querySelector(".parameters");e.classList.remove("block"),e.classList.add("hidden"),document.removeEventListener("click",y)},n}function createViewImageGroup(a,c,t=null){var e="ontouchstart"in window||navigator.msMaxTouchPoints,o=document.querySelector(".view-image-group-template").content.cloneNode(!0);const n=o.querySelector(".view-root"),r=n.querySelector(".image");let i=0;function l(){i=(i+1)%a.length,r.src=a[i].fullPath}r.src=a[i].fullPath,n.querySelector(".touchscreen-back-button").addEventListener("click",function(){i=(i-1+a.length)%a.length,r.src=a[i].fullPath}),n.querySelector(".touchscreen-next-button").addEventListener("click",l),e||(r.addEventListener("mouseover",function(){mouseIntervalId=setInterval(l,100)}),r.addEventListener("mouseout",function(){clearInterval(mouseIntervalId)}));const s=n.querySelector(".censure");function d(){s.querySelector(".fa-eye").classList.toggle("hidden"),s.querySelector(".fa-eye-slash").classList.toggle("hidden"),r.style.filter=r.style.filter?"":"blur(50px)"}!0===c.censure?(d(),s.onclick=d):s.classList.add("hidden"),n.querySelectorAll(".download-archive").forEach(r=>{r.addEventListener("click",()=>{r.innerHTML='<i style="font-size: 1.2rem;width:20px;height:20px;text-align: center;" class="fa-regular fa-file-zipper"></i>';const o=new JSZip,n=[];a.forEach(t=>{var e=fetch(t.fullPath).then(e=>e.blob()).then(e=>{o.file(t.name,e)}).catch(e=>console.error("Error fetching file:",e));n.push(e)}),Promise.all(n).then(()=>{o.generateAsync({type:"blob"}).then(e=>{var e=window.URL.createObjectURL(e),t=document.createElement("a");t.href=e,t.download=c.name+".zip",t.click(),window.URL.revokeObjectURL(e),r.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="#0D0D0D"><path d="M17.5 12.5V15.8333C17.5 16.2754 17.3244 16.6993 17.0118 17.0118C16.6993 17.3244 16.2754 17.5 15.8333 17.5H4.16667C3.72464 17.5 3.30072 17.3244 2.98816 17.0118C2.67559 16.6993 2.5 16.2754 2.5 15.8333V12.5M5.83333 8.33333L10 12.5M10 12.5L14.1667 8.33333M10 12.5V2.5" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg>'}).catch(e=>console.error("Error creating archive:",e))})})});const u=n.querySelector(".description");e=n.querySelector(".datetime-created");function m(e){var t=n.querySelector(".open-parameters-view"),o=n.querySelector(".parameters"),e=e.target;o.contains(e)||t.contains(e)||n.querySelector(".close-parameters-view").click()}return u.textContent=c.name,e.textContent=formatDateTime(c.created),n.querySelector(".repost-button").onclick=function(){var e=a.map(e=>e.fullPath).join(", "),t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),t.setSelectionRange(0,t.value.length),document.execCommand("copy"),document.body.removeChild(t)},n.querySelector(".open-image-modal-button").onclick=function(){createModalImageGroup(a,c,t)},n.querySelector(".copy-description-button").onclick=function(){var e=u.textContent,t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),t.setSelectionRange(0,t.value.length),document.execCommand("copy"),document.body.removeChild(t)},n.querySelectorAll(".delete-all-button").forEach(e=>{e.addEventListener("click",()=>{openDeleteAllFilesNoticeModal(a,t).then(e=>{}).catch(e=>{console.error("Error:",e)})})}),n.querySelector(".open-parameters-view").onclick=function(){fetchYamlData(src.replace(/\.[^/.]+$/,".yaml")).then(e=>{e||(parametersView.classList.remove("hidden"),parametersView.classList.add("block"),setTimeout(()=>{document.addEventListener("click",m)},100))})},n.querySelector(".close-parameters-view").onclick=function(){var e=n.querySelector(".parameters");e.classList.remove("block"),e.classList.add("hidden"),document.removeEventListener("click",m)},o}function createViewAudio(o,e,t=null){var n=document.querySelector(".view-audio-template").content.cloneNode(!0);const r=n.querySelector(".view-root");getFileMetadataDate(e.created);r.setAttribute("data-date",formatDateTime(e.created)),r.setAttribute("data-path",o);const a=r.querySelector(".audio"),c=(a.src=o,r.querySelector(".download"));c.href=o,c.download=e.name;var i=new URL(window.location.href);i.origin,i.pathname;const l={[getTranslationBabel("Clone voice")]:"/clone-voice",[getTranslationBabel("Separator")]:"/separator"};var i=Object.keys(l),s=r.querySelector(".edit-input");const d=new Awesomplete(s,{list:i,minChars:0,maxItems:10}),u=(s.addEventListener("focus",function(){d.evaluate(),d.open()}),d.ul.style.maxHeight="10rem",d.ul.style.maxWidth="20px",d.ul.style.overflowX="hidden",s.addEventListener("awesomplete-selectcomplete",async function(e){e.text.value in l&&(e=l[e.text.value],window.location.href=e+"?attachment="+o)}),r.querySelector(".description"));i=r.querySelector(".datetime-created");const m=r.querySelector(".audio-control"),v=r.querySelector(".sound-button"),h=r.querySelector(".current-time"),p=r.querySelector(".duration"),f=r.querySelector(".current-time-slider"),y=r.querySelector(".audio-wave");function w(e){var t=r.querySelector(".open-parameters-view"),o=r.querySelector(".parameters"),e=e.target;o.contains(e)||t.contains(e)||r.querySelector(".close-parameters-view").click()}function g(e){const c=20,i=document.createElement("canvas"),t=(i.style.opacity=.5,i.width=y.offsetWidth,i.height=y.offsetHeight-2*c,y.appendChild(i),window.AudioContext=window.AudioContext||window.webkitAudioContext,new AudioContext);const l=(e,t,o,n,r)=>{e.lineWidth=1,e.strokeStyle="#fff",e.fillStyle="#fff",e.beginPath(),o=r?o:-o,o=-Math.abs(o),e.moveTo(t,0),e.lineTo(t,o),e.arc(t+n/2,o,n/2,0,0,r),e.lineTo(t+n,0),e.stroke(),e.fill()};fetch(e).then(e=>e.arrayBuffer()).then(e=>t.decodeAudioData(e)).then(e=>{{var o=(e=>{const t=Math.pow(Math.max(...e),-1);return e.map(e=>e*t)})((e=>{const n=e.getChannelData(0),t=100,r=Math.floor(n.length/t),a=[];for(let e=0;e<t;e++){let t=r*e;let o=0;for(let e=0;e<r;e++)o=o+Math.abs(n[t+e]);a.push(o/r)}return a})(e)),t=window.devicePixelRatio||1,n=(i.width=i.offsetWidth*t,i.height=(i.offsetHeight+2*c)*t,i.getContext("2d")),r=(n.scale(t,t),n.translate(0,i.offsetHeight/2+c),i.offsetWidth/o.length);for(let t=0;t<o.length;t++){var a=r*t;let e=o[t]*i.offsetHeight-c;e<0?e=0:e>i.offsetHeight/2&&(e=e>i.offsetHeight/2),l(n,a,e,r,(t+1)%2)}}})}function S(e){return Math.floor(e/60)+":"+Math.floor(e%60).toString().padStart(2,"0")}return u.textContent=e.name,i.textContent=formatDateTime(e.created),y.addEventListener("click",function(e){var t=this.getBoundingClientRect(),o=this.parentElement.getBoundingClientRect(),e=e.pageX-t.left-(o.left-t.left),o=this.offsetWidth,t=Math.min(e,o)/o*100,e=(f.style.left=t+"%",a.duration),o=e*t/100;a.currentTime=o}),r.querySelector(".repost-button").onclick=function(){var e=o,t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),t.setSelectionRange(0,t.value.length),document.execCommand("copy"),document.body.removeChild(t)},r.querySelector(".rename-button").onclick=function(){openRenameNoticeModal(o,t).then(e=>{u.textContent=e.newFileName;var t=createStaticSrc(e.srcFilePath,e.newFileName);o=t,image.src=t,c.href=t,c.download=e.newFileName}).catch(e=>{})},r.querySelector(".delete-button").onclick=function(){openDeleteNoticeModal(o,t).then(e=>{!0===e&&r.remove()}).catch(e=>{console.error("Error:",e)})},r.querySelector(".open-parameters-view").onclick=function(){fetchYamlData(o.replace(/\.[^/.]+$/,".yaml")).then(e=>{e||(parametersView.classList.remove("hidden"),parametersView.classList.add("block"),setTimeout(()=>{document.addEventListener("click",w)},100))})},r.querySelector(".close-parameters-view").onclick=function(){var e=r.querySelector(".parameters");e.classList.remove("block"),e.classList.add("hidden"),document.removeEventListener("click",w)},v.addEventListener("click",function(){a.muted=!a.muted;var e=a.muted?'<svg style="scale:1.4;" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" class="h-4"><path stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-opacity="0.85" stroke-width="1.5" d="m14.667 6-4 4m0-4 4 4M7.333 3.333 4 6H1.333v4H4l3.333 2.667V3.333Z"></path></svg>':'<svg style="scale:1.4;" xmlns="http://www.w3.org/2000/svg" width="16" height="12" viewBox="0 0 16 12" fill="none" class="h-4"><path stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-opacity="0.85" stroke-width="1.5" d="M10.36 3.64a3.333 3.333 0 0 1 0 4.713m2.353-7.066a6.667 6.667 0 0 1 0 9.426m-5.38-9.38L4 4H1.333v4H4l3.333 2.667V1.333Z"></path></svg>';v.innerHTML=e}),m.addEventListener("click",function(){a.paused?a.play():a.pause();var e=a.paused?'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="#fff"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4.167 2.5 15.832 10 4.166 17.5v-15Z"></path></svg>':'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="#fff"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7.833 3.333H4.5v13.334h3.333V3.333ZM15.5 3.333h-3.333v13.334H15.5V3.333Z"></path></svg>';m.innerHTML=e}),a.addEventListener("ended",function(){m.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="#fff"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4.167 2.5 15.832 10 4.166 17.5v-15Z"></path></svg>'}),a.addEventListener("loadedmetadata",function(){a.pause(),a.muted=!1;var e=S(a.duration);h.textContent="0:00",p.textContent=""+e,g(a.src)}),a.addEventListener("timeupdate",function(){var e=S(a.currentTime),t=S(a.duration),o=a.currentTime/a.duration*100;h.textContent=""+e,p.textContent=""+t,f.style.left=o+"%"}),n}function createViewFilter(){"ontouchstart"in window||navigator.msMaxTouchPoints;var e=document.querySelector(".view-filter-template").content.cloneNode(!0);e.querySelector(".view-root");const o=e.querySelector(".view-filter-all"),n=e.querySelector(".view-filter-video"),r=e.querySelector(".view-filter-image"),a=e.querySelector(".view-filter-images-group"),c=e.querySelector(".view-filter-audio");e.querySelector(".view-filter-favorites");function t(e,t){userFileFormats=t,reloadViewContent(moduleName,t),[o,n,r,a,c].forEach(e=>{e.classList.remove("opacity-100","border-b"),e.classList.add("opacity-60")}),e.classList.remove("opacity-60"),e.classList.add("opacity-100","border-b")}return userFileFormats.includes("video")&&n.classList.remove("hidden"),userFileFormats.includes("image")&&r.classList.remove("hidden"),userFileFormats.includes("group")&&a.classList.remove("hidden"),userFileFormats.includes("audio")&&c.classList.remove("hidden"),o.onclick=function(){t(this,pageFileFormats)},n.onclick=function(){t(this,["video"])},r.onclick=function(){t(this,["image"])},a.onclick=function(){t(this,["group"])},c.onclick=function(){t(this,["audio"])},e}function createViewLoad(e){"ontouchstart"in window||navigator.msMaxTouchPoints;var t=document.querySelector(".view-load-template").content.cloneNode(!0);const o=t.querySelector(".view-root");var n=e.request_id,r=e.progress||0,a=e.progress_message||0,n=(o.dataset.requestId=n,o.querySelector(".description")),c=o.querySelector(".datetime-created"),i=o.querySelector(".progress-message");function l(e){var t=o.querySelector(".open-parameters-view"),e=e.target;parametersView.contains(e)||t.contains(e)||closeParametersView.click()}return n.textContent=e.name,c.textContent=formatDateTime(e.created),i.textContent=a+` ${r}%`,o.querySelector(".hidden-button ").onclick=function(){o.classList.add("hidden")},o.querySelector(".open-parameters-view").onclick=function(){var e=o.querySelector(".parameters");e.classList.remove("hidden"),e.classList.add("block"),setTimeout(()=>{document.addEventListener("click",l)},100)},o.querySelector(".close-parameters-view").onclick=function(){var e=o.querySelector(".parameters");e.classList.remove("block"),e.classList.add("hidden"),document.removeEventListener("click",l)},t}function updateViewLoad(o){const r=document.querySelector(".view-content"),a=r.querySelectorAll(".view-load");Array.from(a).map(e=>e.dataset.requestId);o.forEach(e=>{const t=e.request_id;var o=`${e.progress_message} ${e.progress}%`,n=Array.from(a).find(e=>e.dataset.requestId===t);n?n.querySelector(".progress-message").textContent=o:(n=createViewLoad(e),r.insertBefore(n,r.firstChild))}),a.forEach(e=>{const t=e.dataset.requestId;o.some(e=>e.request_id===t)||e.remove()})}async function removeViewLoadUniq(e){const n=document.querySelector(".view-content");var t=n.querySelectorAll(".view-load");async function o(e,t){n.insertBefore(e,n.children[t]);const o=e.querySelector("video");o&&await new Promise(e=>{o.onloadeddata=()=>{e()}})}if(Array.isArray(e)&&e.some){console.log(e);for(const s of t){const d=s.dataset.requestId;var r=e.find(e=>e.request_id===d);if(r){r=r.output?.media;if(r){var a=Array.isArray(r)?r:[r];console.log(r);const u={audio:[".wav",".mp3"],video:[".mov",".mp4"],image:[".png",".jpg",".jpeg"]};var c,i,l=Array.from(n.children).indexOf(s);s.remove();for(const m of a)m&&((c=Object.keys(u).find(e=>u[e].some(e=>m.endsWith(e))))?(i={name:m.split("/").pop(),created:new Date},"audio"===c?(console.log("Audio file: "+m),await o(createViewAudio(m,i,()=>reloadViewContent(moduleName,userFileFormats)),l)):"video"===c?(console.log("Video file: "+m),await o(createViewVideoStatic(m,i,()=>reloadViewContent(moduleName,userFileFormats)),l)):"image"===c&&(console.log("Image file: "+m),await o(createViewImage(m,i,()=>reloadViewContent(moduleName,userFileFormats)),l))):console.warn("Unknown file type: "+m))}}}}else console.error("Response is not an array or does not have the some function:",e)}async function createViewModule(e=0,t,o){var n=document.querySelector(".view-module-template").content.cloneNode(!0),r=n.querySelector(".view-root"),a=r.querySelector(".module-title"),c=r.querySelector(".module-subtitle"),i=r.querySelector(".module-description"),l=r.querySelector(".module-format"),s=r.querySelector(".module-version"),r=r.querySelector(".module-index");return a.textContent=t.title,c.innerHTML=t.subtitle,i.innerHTML=t.description,l.textContent=t.getFormatString()+":",t.isPro&&s.classList.remove("hidden"),r.textContent=e,a.onclick=async function(){if(t.isPro)try{var e=await fetch("/get-processor");if(!e.ok)throw new Error("Failed to fetch processor");"cpu"===(await e.json()).current_processor?createModalMessage(t.title+" "+getTranslationBabel("requires a GPU to function. If your system supports it, please switch from CPU to GPU in your settings.")):window.location.href=t.url}catch(e){console.error("Error:",e.message),createModalMessage(getTranslationBabel("An error occurred while checking the processor. Please try again later."))}else window.location.href=t.url},n}