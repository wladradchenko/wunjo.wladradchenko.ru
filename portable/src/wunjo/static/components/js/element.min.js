function observeAttributeChange(e,i="value",s){new MutationObserver(t=>{t.forEach(t=>{"attributes"===t.type&&t.attributeName===i&&(t=e.getAttribute(i),s(t))})}).observe(e,{attributes:!0})}class Notice extends HTMLElement{constructor(){super(),this.classList.add("flex","gap-2.5","text-m-mobile","md:text-m","p-2.5","bg-dark-background","bg-opacity-30","rounded-md"),this.icon=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.icon.setAttribute("width","20"),this.icon.setAttribute("height","20"),this.icon.setAttribute("viewBox","0 0 20 20"),this.icon.setAttribute("stroke","#fff"),this.icon.setAttribute("fill","#fff"),this.icon.classList.add("shrink-0"),this.icon.innerHTML='<g clip-path="url(#a)"><path fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-opacity="0.6" stroke-width="1.5" d="M10 6.666V10m0 3.333h.008M18.333 10a8.333 8.333 0 1 0-16.667 0 8.333 8.333 0 0 0 16.667 0Z"></path></g><defs><clipPath id="a"><path stroke="none" d="M0 0h20v20H0z"></path></clipPath></defs>',this.appendChild(this.icon),this.message=document.createElement("span"),this.appendChild(this.message)}connectedCallback(){this.message.textContent=this.getAttribute("value")||"",observeAttributeChange(this,"status",function(t){"ok"===t?(this.classList.add("bg-accent-primary"),this.classList.remove("bg-dark-background","bg-danger-primary")):"error"===t?(this.classList.add("bg-danger-primary"),this.classList.remove("bg-dark-background","bg-accent-primary")):(this.classList.add("bg-dark-background"),this.classList.remove("bg-accent-primary","bg-danger-primary"))}.bind(this)),observeAttributeChange(this,"value",function(t){this.message.textContent=t}.bind(this))}}class SliderComponent extends HTMLElement{constructor(){super(),this.classList.add("gap-2.5","text-m-mobile","md:text-m","p-2.5","bg-opacity-30","rounded-md","bg-dark-tags","text-s","flex","flex-col","gap-5","overflow-auto","transition-[height_max-height]","pr-2"),this.header=document.createElement("div"),this.header.classList.add("flex","gap-3","items-center","justify-between"),this.label=document.createElement("p"),this.label.classList.add("opacity-50","font-extra-thick"),this.header.appendChild(this.label),this.inputField=document.createElement("input"),this.inputField.classList.add("px-2","py-1.5","rounded-md","bg-dark-pop-up","w-8","box-content","text-center","outline-none"),this.inputField.setAttribute("type","number"),this.header.appendChild(this.inputField),this.appendChild(this.header),this.sliderContainer=document.createElement("div"),this.sliderContainer.classList.add("flex","gap-4","items-center","text-m-mobile","lg:text-m"),this.minLabel=document.createElement("span"),this.minLabel.classList.add("opacity-60"),this.sliderContainer.appendChild(this.minLabel),this.slider=document.createElement("input"),this.slider.classList.add("relative","slider","flex-1","appearance-none","h-1","bg-light-border","rounded-md","outline-none","after:absolute","after:left-0","after:top-0","after:h-1","after:rounded-md","after:bg-accent-primary","after:w-[var(--fill-size)]","after:z-0"),this.slider.setAttribute("type","range"),this.sliderContainer.appendChild(this.slider),this.maxLabel=document.createElement("span"),this.maxLabel.classList.add("opacity-60"),this.sliderContainer.appendChild(this.maxLabel),this.appendChild(this.sliderContainer)}connectedCallback(){var t=this.getAttribute("min")||1;let e=this.getAttribute("max")||100;var i=this.getAttribute("step")||1,s=this.getAttribute("value")||47,n=this.getAttribute("fill-size")||s,a=this.getAttribute("name")||"Threshold";this.label.textContent=a,this.inputField.setAttribute("min",t),this.inputField.setAttribute("max",e),this.inputField.setAttribute("step",i),this.inputField.setAttribute("value",s),this.slider.setAttribute("min",t),this.slider.setAttribute("max",e),this.slider.setAttribute("step",i),this.slider.setAttribute("value",s),this.slider.style.setProperty("--fill-size",n+"%"),this.minLabel.textContent=t,this.maxLabel.textContent=e,this.inputField.addEventListener("input",t=>{t=t.target.value;this.setAttribute("value",t),this.slider.value=t,this.slider.style.setProperty("--fill-size",t/e*100+"%")}),this.slider.addEventListener("input",t=>{t=t.target.value;this.setAttribute("value",t),this.inputField.value=t,this.inputField.dispatchEvent(new Event("input"))})}}class ButtonComponent extends HTMLButtonElement{constructor(){super(),this.setAttribute("type","button"),this.classList.add("relative","rounded-md","items-center","justify-center","transition-colors","font-normal","disabled:cursor-not-allowed");var t=document.createElement("text"),e=(t.classList.add("absolute","top-0","right-1","text-[10px]"),t.style.display="none",t.textContent="PRO",document.createElement("span")),i=(e.classList.add("icon"),document.createElement("span"));i.classList.add("button-name"),this.append(t,e,i)}connectedCallback(){var t=this.getAttribute("extra-icon")||"",e=this.getAttribute("name")||"",i="true"===this.getAttribute("is-pro");let s=this.getAttribute("href"),n=this.getAttribute("target");var a=this.querySelector(".icon"),t=(t?a.innerHTML=t:a.classList.add("hidden"),this.querySelector(".button-name")),a=(e?t.textContent=e:t.classList.add("hidden"),this.querySelector("text"));a.style.display=i?"inline":"none",s&&(this.onclick=t=>{n?window.open(s,"_blank"):window.location.href=s})}}class ButtonComponentPrimary extends ButtonComponent{constructor(){super(),this.classList.add("flex","px-1.5","gap-2","py-2.5","grow","hover:bg-accent-hover","text-dark-background","bg-accent-primary")}}class ButtonComponentSecondary extends ButtonComponent{constructor(){super(),this.classList.add("flex","px-1.5","gap-2","py-2.5","grow","bg-light-emphasis","hover:bg-dark-elements-hover","text-light-primary","bg-dark-elements")}}class ButtonComponentMini extends ButtonComponent{constructor(){super(),this.classList.add("px-2.5","gap-1","text-m","hover:bg-accent-hover","text-dark-background","bg-accent-primary")}}class ButtonNav{constructor(t){this.container=document.createElement("button"),this.container.classList.add("group","grid","gap-2","justify-between","items-center"),this.container.style.gridTemplateColumns="1fr 3fr",this.container.style.textAlign="left";var e=document.createElement("div");e.classList.add("opacity-60","group-hover:opacity-100","transition-opacity","flex","flex-col"),this.spanMethod=document.createElement("span"),this.spanMethod.textContent=t.method||"",this.spanDate=document.createElement("span"),this.spanDate.textContent=t.date||"",this.spanDate.classList.add("text-s"),this.preview=document.createElement("div"),this.preview.classList.add("preview-box","flex"),"mp4"===t.format?this.container.innerHTML='<i style="font-size: xx-large;" class="fa-solid fa-file-video opacity-90 group-hover:opacity-100 transition-opacity"></i>':"jpg"===t.format?this.container.innerHTML='<i style="font-size: xx-large;" class="fa-solid fa-file-image opacity-90 group-hover:opacity-100 transition-opacity"></i>':"wav"===t.format&&(this.container.innerHTML='<i style="font-size: xx-large;" class="fa-solid fa-file-audio opacity-90 group-hover:opacity-100 transition-opacity"></i>'),e.append(this.spanMethod,this.spanDate),this.container.append(e,this.preview)}}function createGeneralSelectInput({label:t,dataDict:e,minChars:i=0,maxItems:s=null,defaultValue:n,disableStatus:a=!1,onChange:r}){var l=document.createElement("div"),o=(l.classList.add("flex","gap-3","items-center","justify-between"),document.createElement("p"));o.classList.add("font-extra-thick"),o.textContent=t;let h=document.createElement("input"),d=(h.classList.add("px-2","py-1.5","rounded-md","bg-dark-elements","w-32","box-content","text-center","outline-none"),h.type="text",h.value=n,h.disabled=a,l.append(o,h),Object.keys(e)),c=(h.addEventListener("input",function(t){d.includes(t.target.value)&&r(t.target.value)}),new Awesomplete(h,{list:d,minChars:i,maxItems:s||d.length}));return h.addEventListener("focus",function(){h.value="",c.evaluate()}),h.addEventListener("awesomplete-selectcomplete",function(t){d.includes(t.text.value)&&r(t.target.value)}),{wrapper:l}}function createGeneralTextInput({label:t,defaultValue:e,disableStatus:i=!1,onChange:s=null}){var n=document.createElement("div"),a=(n.classList.add("flex","gap-3","items-center","justify-between"),document.createElement("p"));a.classList.add("font-extra-thick"),a.textContent=t;let r=document.createElement("input");return r.classList.add("px-2","py-1.5","rounded-md","bg-dark-elements","w-32","box-content","text-center","outline-none"),r.type="text",r.value=e,r.disabled=i,s&&r.addEventListener("change",()=>s(r.value)),n.append(a,r),{wrapper:n}}function createGeneralRadioButton({label:t,defaultValue:e,isPro:i=!1,isGpu:s=!1,onChange:n=null}){var a=document.createElement("div"),r=(a.classList.add("flex","gap-1.5","items-center"),document.createElement("p"));r.classList.add("flex-1","basis-1/3"),r.textContent=t;let l=document.createElement("button");return l.classList.add("relative","rounded-md","flex","items-center","justify-center","transition-colors","font-normal","disabled:cursor-not-allowed","px-2.5","gap-2","py-2.5","basis-1/3","flex-1","!bg-dark-elements","hover:bg-dark-elements-hover","text-light-primary","bg-dark-elements"),l.type="button",l.innerHTML=(i?'<text class="absolute top-0 right-1 text-[10px]">PRO</text>':"")+'<i class="fa-solid fa-thumbs-up"></i>',e&&(l.classList.add("!bg-accent-primary","!text-dark-background"),l.classList.remove("!bg-dark-elements")),s&&(async()=>{try{!0===(await getAccess()).useCpu&&(l.disabled=!0)}catch(t){console.error("Error in synchronous context:",t)}})(),n&&l.addEventListener("click",async()=>(async()=>{async function t(){l.classList.contains("!bg-dark-elements")?(l.classList.add("!bg-accent-primary","!text-dark-background"),l.classList.remove("!bg-dark-elements"),n(!0)):(l.classList.remove("!bg-accent-primary","!text-dark-background"),l.classList.add("!bg-dark-elements"),n(!1))}await(i?createConnection(t):t())})()),a.append(r,l),{wrapper:a}}function createGeneralSliderInput({label:t,min:e,max:i,step:s,titleMax:n=null,titleMin:a=null,defaultValue:r,onChange:l}){var o=document.createElement("div"),h=(o.classList.add("flex","flex-col","gap-3"),document.createElement("div")),d=(h.classList.add("flex","gap-3","items-center","justify-between"),document.createElement("p"));d.classList.add("font-extra-thick"),d.textContent=getTranslationBabel(t);let c=document.createElement("input");c.classList.add("px-2","py-1.5","rounded-md","bg-dark-elements","w-8","box-content","text-center","outline-none"),c.type="number",c.min=e,c.max=i,c.step=s,c.value=r;var t=document.createElement("div"),m=(t.classList.add("flex","gap-4","items-center","text-m-mobile","lg:text-m"),document.createElement("span"));m.classList.add("opacity-60"),m.textContent=e,m.title=a;let u=document.createElement("input");u.classList.add("relative","slider","flex-1","appearance-none","h-1","bg-light-border","rounded-md","outline-none","after:absolute","after:left-0","after:top-0","after:h-1","after:rounded-md","after:bg-accent-primary","after:w-[var(--fill-size)]","after:z-0"),u.type="range",u.min=e,u.max=i,u.step=s,u.value=r;a=document.createElement("span");function p(t){t=Math.ceil((t-e)/(i-e)*100);u.style.setProperty("--fill-size",t+"%")}a.classList.add("opacity-60"),a.textContent=i,a.title=n,p(r);let g=t=>{c.value=t,p(u.value=t),l(t)};return c.addEventListener("change",()=>g(c.value)),u.addEventListener("input",()=>g(u.value)),t.append(m,u,a),h.append(d,c),o.append(h,t),{wrapper:o}}class AudioHandler{constructor(t){this.data=t.data||{},this.LISTEN_ICONS={on:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="#fff"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7.833 3.333H4.5v13.334h3.333V3.333ZM15.5 3.333h-3.333v13.334H15.5V3.333Z"></path></svg>',off:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="#fff"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4.167 2.5 15.832 10 4.166 17.5v-15Z"></path></svg>'},this.duration=0,this.maxDuration=t.maxDuration||10,this.minGap=10,this.listen=!1,this.src=t.src||"",this.container=t.container,this.audioContainer=this.container.querySelector(".js-audio-container"),this.audio=this.container.querySelector(".js-audio-element"),this.audio.src=this.src,this.loaderContainer=this.container.querySelector(".js-loader-bar"),this.loaderContainer&&(t.isLoaderId?this.loaderContainer.setAttribute("data-index",t.isLoaderId):this.loaderContainer.remove()),this.createTimeline(),this.setupEventListeners()}setupEventListeners(){this.loadedMetadata(),this.timeUpdate()}createSliderElement(t){var e=document.createElement("div");switch(e.classList.add("absolute"),t){case"left":e.classList.add("h-full","left-0","flex-row","flex","bg-dark-elements","opacity-90","z-[2]");break;case"right":e.classList.add("h-full","right-0","flex-row","flex","bg-dark-elements","opacity-90","z-[2]");break;case"between":e.classList.add("h-14","left-0","w-full","z-2")}return e}createTimeline(){this.timeline={container:this.container.querySelector(".js-timeline-main"),track:{element:this.container.querySelector(".js-timeline-track"),left:this.container.querySelector(".js-timeline-range-left"),right:this.container.querySelector(".js-timeline-range-right"),current:this.container.querySelector(".js-timeline-current")},controls:{restart:this.container.querySelector(".js-restart-button"),listen:this.container.querySelector(".js-audio-listen")},markers:{start:this.container.querySelector(".js-timeline-markers-start"),end:this.container.querySelector(".js-timeline-markers-end")},sliders:{left:this.createSliderElement("left"),right:this.createSliderElement("right"),between:this.createSliderElement("between")}},this.timeline.container.append(this.timeline.sliders.left,this.timeline.sliders.right,this.timeline.sliders.between),this.timeline.controls.listen.addEventListener("click",()=>{this.audio.paused?this.audio.play():this.audio.pause();var t=this.audio.paused?this.LISTEN_ICONS.off:this.LISTEN_ICONS.on;this.timeline.controls.listen.innerHTML=t}),this.timeline.controls.listen.innerHTML=this.LISTEN_ICONS.off,this.timeline.sliders.between.addEventListener("click",t=>{var e=this.timeline.sliders.between.getBoundingClientRect(),i=this.timeline.track.element.getBoundingClientRect(),t=t.pageX-e.left-(i.left-e.left),i=(this.timeline.sliders.between.offsetWidth,Math.min(t,this.timeline.sliders.between.offsetWidth)/this.timeline.sliders.between.offsetWidth*100),e=(this.timeline.track.current.style.left=i+"%",this.duration*i/100);this.audio.currentTime=e}),this.timeline.track.element.addEventListener("click",t=>{var e=this.timeline.track.element.getBoundingClientRect(),i=this.timeline.container.getBoundingClientRect(),t=t.pageX-e.left-(i.left-e.left),i=(this.timeline.track.element.offsetWidth,Math.min(t,this.timeline.track.element.offsetWidth)/this.timeline.track.element.offsetWidth*100),e=(this.timeline.track.current.style.left=i+"%",this.duration*i/100);this.audio.currentTime=e}),this.timeline.track.left.oninput=()=>{parseInt(this.timeline.track.right.value)-parseInt(this.timeline.track.left.value)<=this.minGap&&(this.timeline.track.left.value=parseInt(this.timeline.track.right.value)-this.minGap);var t=this.timeline.track.element.offsetWidth*this.timeline.track.left.value/(this.timeline.track.left.max-this.timeline.track.left.min),t=(this.timeline.markers.start.style.left=t+"px",this.timeline.track.element.offsetWidth*this.timeline.track.left.value/(this.timeline.track.left.max-this.timeline.track.left.min));this.timeline.sliders.left.style.width=t+"px",this.start=this.calcTimeBySliderVal(this.timeline.track.left.value,this.timeline.track.left.max,this.timeline.track.left.min),isFinite(this.start)&&(this.timeline.markers.start.textContent=this.formatTime(this.start)),this.updateCutTimeInformation()},this.timeline.track.right.oninput=()=>{parseInt(this.timeline.track.right.value)-parseInt(this.timeline.track.left.value)<=this.minGap&&(this.timeline.track.right.value=parseInt(this.timeline.track.left.value)+this.minGap);var t=this.timeline.track.element.offsetWidth-this.timeline.track.element.offsetWidth*this.timeline.track.right.value/(this.timeline.track.right.max-this.timeline.track.right.min),t=(this.timeline.markers.end.style.right=t+"px",this.timeline.track.element.offsetWidth-this.timeline.track.element.offsetWidth*this.timeline.track.right.value/(this.timeline.track.right.max-this.timeline.track.right.min));this.timeline.sliders.right.style.width=t+"px",this.end=this.calcTimeBySliderVal(this.timeline.track.right.value,this.timeline.track.right.max,this.timeline.track.right.min),isFinite(this.end)&&(this.timeline.markers.end.textContent=this.formatTime(this.end)),this.updateCutTimeInformation()},this.timeline.controls.restart.onclick=()=>{this.audio.currentTime=this.start}}updateCutTimeInformation(){this.data.startTime=this.start,this.data.endTime=this.end}formatTime(t){var e=Math.floor(t/60),t=Math.floor(t%60);return e.toString().padStart(2,"0")+":"+t.toString().padStart(2,"0")}calcTimeBySliderVal(t,e,i){return Math.abs(t/(i-e)*this.duration).toFixed(2)}calcValBySliderTime(t,e,i){return Math.abs(t/this.duration*(i-e)).toFixed(2)}drawSpectrum(t){var e=this.timeline.container;let r=20,l=document.createElement("canvas"),i=(l.style.opacity=.5,l.width=e.offsetWidth,l.height=e.offsetHeight-2*r,e.insertBefore(l,this.timeline.sliders.between),window.AudioContext=window.AudioContext||window.webkitAudioContext,new AudioContext);let s=t=>{var i=t.getChannelData(0),s=Math.floor(i.length/100),n=[];for(let t=0;t<100;t++){var a=s*t;let e=0;for(let t=0;t<s;t++)e+=Math.abs(i[a+t]);n.push(e/s)}return n},n=t=>{let e=Math.pow(Math.max(...t),-1);return t.map(t=>t*e)},a=i=>{var t=window.devicePixelRatio||1,s=(l.width=l.offsetWidth*t,l.height=(l.offsetHeight+2*r)*t,l.getContext("2d")),n=(s.scale(t,t),s.translate(0,l.offsetHeight/2+r),l.offsetWidth/i.length);for(let e=0;e<i.length;e++){var a=n*e;let t=i[e]*l.offsetHeight-r;t<0?t=0:t>l.offsetHeight/2&&(t=t>l.offsetHeight/2),o(s,a,t,n,(e+1)%2)}},o=(t,e,i,s,n)=>{t.lineWidth=1,t.strokeStyle="#fff",t.fillStyle="#fff",t.beginPath(),i=n?i:-i,i=-Math.abs(i),t.moveTo(e,0),t.lineTo(e,i),t.arc(e+s/2,i,s/2,0,0,n),t.lineTo(e+s,0),t.stroke(),t.fill()};fetch(t).then(t=>t.arrayBuffer()).then(t=>i.decodeAudioData(t)).then(t=>a(n(s(t))))}timeUpdate(){this.audio.addEventListener("timeupdate",()=>{this.start>this.audio.currentTime&&isFinite(this.timeline.track)&&(this.currentTime=this.start),this.end<this.audio.currentTime&&isFinite(this.start)&&(this.audio.currentTime=this.start),(this.duration||isFinite(this.audio.duration))&&(this.timeline.track.current.style.left=this.audio.currentTime/this.duration*100+"%")})}loadedMetadata(){this.audio.addEventListener("loadedmetadata",()=>{this.start=0,this.timeline.markers.start.textContent="0:00",!this.duration&&isFinite(this.audio.duration)?(this.end=this.audio.duration,this.duration=this.audio.duration):this.end=this.duration,this.duration>this.maxDuration&&(this.end=this.maxDuration),this.data.startTime=this.start,this.data.endTime=this.end,this.timeline.markers.end.textContent=this.formatTime(this.end),this.timeline.track.right.value=this.calcValBySliderTime(this.end,this.timeline.track.right.min,this.timeline.track.right.max),this.timeline.track.right.oninput(),this.minGap=Math.min((this.timeline.track.right.max-this.timeline.track.right.min)/this.duration,(this.timeline.track.left.max-this.timeline.track.left.min)/this.duration),this.drawSpectrum(this.src)})}}class SegmentAudioHandler extends AudioHandler{constructor(t){super(t),this.segments=[],this.currentSegmentIndex=0,this.playingSegments=!1,this._boundHandleSegmentPlayback=this.handleSegmentPlayback.bind(this),this.audio.addEventListener("timeupdate",this._boundHandleSegmentPlayback);let i=this.timeline?.controls?.listen;if(i){let e=i.onclick;i.addEventListener("click",t=>{t.stopPropagation(),0<this.segments.length?this.playingSegments?this.stopSegments():this.playSegments():"function"==typeof e?e.call(i,t):this.audio.paused?this.audio.play():this.audio.pause()})}this.timeline.track.left.classList.add("hidden"),this.timeline.track.right.classList.add("hidden")}setSegments(t){Array.isArray(t)||(t=[]),this.segments=t.map(t=>({start:parseFloat(t.start),end:parseFloat(t.end),text:t.text})).filter(t=>!isNaN(t.start)&&!isNaN(t.end)&&t.end>t.start).sort((t,e)=>t.start-e.start),this.currentSegmentIndex=0}playSegments(){this.segments.length?(this.playingSegments=!0,this.currentSegmentIndex=0,this._playSegmentByIndex(this.currentSegmentIndex)):stopSegments()}_playSegmentByIndex(t){var e,t=this.segments[t];if(t)try{this.audio.currentTime=t.start,this.audio.paused&&(e=this.audio.play())&&"function"==typeof e.catch&&e.catch(()=>{}),this.currentSegmentEnd=t.end}catch(t){console.warn("Error playing segment",t)}else this.stopSegments()}handleSegmentPlayback(){var t;this.segments.length||this.stopSegments(),this.playingSegments&&this.segments.length&&(t=this.segments[this.currentSegmentIndex])&&this.audio.currentTime>=t.end&&(this.currentSegmentIndex++,this.currentSegmentIndex<this.segments.length||(this.currentSegmentIndex=0),this._playSegmentByIndex(this.currentSegmentIndex))}stopSegments(){this.playingSegments=!1,this.currentSegmentIndex=0,this.timeline.controls.listen.innerHTML=this.LISTEN_ICONS.off;try{this.audio.pause()}catch(t){}}destroySegmentsHandling(){this.audio.removeEventListener("timeupdate",this._boundHandleSegmentPlayback)}}class VideoHandler{constructor(t){this.isTouchDevice="ontouchstart"in window||navigator.msMaxTouchPoints,this.data=t.data||{},this.loadOnInit=t.loadOnInit||!1,this.duration=0,this.minGap=0,this.watch=!1,this.src=t.src||"",this.container=t.container,this.videoContainer=this.container.querySelector(".js-video-container"),this.loaderContainer=this.container.querySelector(".js-loader-circle"),this.loaderContainer&&(t.isLoaderId?this.loaderContainer.setAttribute("data-index",t.isLoaderId):this.loaderContainer.remove()),this.video=this.container.querySelector(".js-video-element"),this.video.autoplay=t.autoplay||!0,this.video.muted=t.muted||!1,this.video.preload=t.preload||"none",this.video.loop=t.loop||!0,this.video.playsInline=t.playsInline||!0,this.video.src=this.src,this.controls={watch:this.container.querySelector(".js-watch-button"),sound:this.container.querySelector(".js-sound-button"),duration:this.container.querySelector(".js-duration")},this.createTimeline(),this.createControlButtons(t),this.setupEventListeners()}createControlButtons(t){if(t.isWatch&&(this.controls.watch.onclick=async()=>{this.watch?this.stop():this.play(),this.watch=!this.watch}),this.controls.sound){this.buttonSound=this.container.querySelector(".js-sound-button");let e={off:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" class="h-4"><path stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-opacity="0.85" stroke-width="1.5" d="m14.667 6-4 4m0-4 4 4M7.333 3.333 4 6H1.333v4H4l3.333 2.667V3.333Z"></path></svg>',on:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="12" viewBox="0 0 16 12" fill="none" class="h-4"><path stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-opacity="0.85" stroke-width="1.5" d="M10.36 3.64a3.333 3.333 0 0 1 0 4.713m2.353-7.066a6.667 6.667 0 0 1 0 9.426m-5.38-9.38L4 4H1.333v4H4l3.333 2.667V1.333Z"></path></svg>'};this.controls.sound.onclick=()=>{this.video.muted=!this.video.muted;var t=this.video.muted?e.off:e.on;this.controls.sound.innerHTML=t,this.video.focus()},this.controls.sound.innerHTML=e.on}}createSliderElement(t){var e=document.createElement("div"),i="h-14 absolute z-2 flex-row flex bg-dark-elements opacity-90";switch(t){case"left":e.classList.add(...(i+" rounded-l-md left-0").split(" "));break;case"right":e.classList.add(...(i+" rounded-r-md right-0").split(" "));break;case"between":e.classList.add(..."h-14 absolute z-2 left-0 w-full".split(" "))}return e}createTimeline(){this.timeline={container:this.container.querySelector(".js-timeline-main"),track:{element:this.container.querySelector(".js-timeline-track"),left:this.container.querySelector(".js-timeline-range-left"),right:this.container.querySelector(".js-timeline-range-right"),current:this.container.querySelector(".js-timeline-current"),bg:this.container.querySelector(".js-timeline-bg")},controls:{start:{back:this.container.querySelector(".js-timeline-start-back"),input:this.container.querySelector(".js-timeline-start-input"),forward:this.container.querySelector(".js-timeline-start-forward")},end:{back:this.container.querySelector(".js-timeline-end-back"),input:this.container.querySelector(".js-timeline-end-input"),forward:this.container.querySelector(".js-timeline-end-forward")}},markers:{container:this.container.querySelector(".js-timeline-markers"),items:this.container.querySelectorAll(".js-timeline-marker")},accessMessages:this.container.querySelectorAll(".js-access-message"),sliders:{left:this.createSliderElement("left"),right:this.createSliderElement("right"),between:this.createSliderElement("between")}},this.timeline.container.append(this.timeline.sliders.left,this.timeline.sliders.right,this.timeline.sliders.between),this.timeline.sliders.between.addEventListener("click",t=>{var e=this.timeline.sliders.between.getBoundingClientRect(),i=this.timeline.container.getBoundingClientRect(),t=t.pageX-e.left-(i.left-e.left),i=this.timeline.sliders.between.offsetWidth,e=Math.min(t,i)/i,t=(this.timeline.track.current.value=e*this.timeline.track.current.max,e*this.duration);this.video.currentTime=parseFloat(t)||0}),this.timeline.container.addEventListener("click",t=>{var e=this.timeline.container.getBoundingClientRect(),i=this.timeline.container.getBoundingClientRect(),t=t.pageX-e.left-(i.left-e.left),i=this.timeline.container.offsetWidth,e=Math.min(t,i)/i,t=(this.timeline.track.current.value=e*this.timeline.track.current.max,e*this.duration);this.video.currentTime=parseFloat(t)||0}),this.timeline.controls.start.back.onclick=()=>{this.timeline.controls.start.input.value=this.startTimeCalcVal(parseFloat(this.timeline.controls.start.input.value)-parseFloat(this.timeline.controls.start.input.step)),this.timeline.track.left.value=this.calcValBySliderTime(parseFloat(this.timeline.controls.start.input.value),this.timeline.track.left.min,this.timeline.track.left.max),this.timeline.track.left.oninput(),this.video.currentTime=parseFloat(this.timeline.controls.start.input.value)||0},this.timeline.controls.start.input.onchange=()=>{this.timeline.controls.start.input.value=this.startTimeCalcVal(parseFloat(this.timeline.controls.start.input.value)),this.timeline.track.left.value=this.calcValBySliderTime(parseFloat(this.timeline.controls.start.input.value),this.timeline.track.left.min,this.timeline.track.left.max),this.timeline.track.left.oninput(),this.video.currentTime=parseFloat(this.timeline.controls.start.input.value)||0},this.timeline.controls.start.forward.onclick=()=>{this.timeline.controls.start.input.value=this.startTimeCalcVal(parseFloat(this.timeline.controls.start.input.value)+parseFloat(this.timeline.controls.start.input.step)),this.timeline.track.left.value=this.calcValBySliderTime(parseFloat(this.timeline.controls.start.input.value),this.timeline.track.left.min,this.timeline.track.left.max),this.timeline.track.left.oninput(),this.video.currentTime=parseFloat(this.timeline.controls.start.input.value)||0},this.timeline.controls.end.back.onclick=()=>{this.timeline.controls.end.input.value=this.endTimeCalcVal(parseFloat(this.timeline.controls.end.input.value)-parseFloat(this.timeline.controls.end.input.step)),this.timeline.track.right.value=this.calcValBySliderTime(parseFloat(this.timeline.controls.end.input.value),this.timeline.track.right.min,this.timeline.track.right.max),this.timeline.track.right.oninput(),this.video.currentTime=parseFloat(this.timeline.controls.end.input.value)||0},this.timeline.controls.end.input.onchange=()=>{this.timeline.controls.end.input.value=this.endTimeCalcVal(parseFloat(this.timeline.controls.end.input.value)),this.timeline.track.right.value=this.calcValBySliderTime(parseFloat(this.timeline.controls.end.input.value),this.timeline.track.right.min,this.timeline.track.right.max),this.timeline.track.right.oninput(),this.viddeo.currentTime=parseFloat(this.timeline.controls.end.input.value)||0},this.timeline.controls.end.forward.onclick=()=>{this.timeline.controls.end.input.value=this.endTimeCalcVal(parseFloat(this.timeline.controls.end.input.value)+parseFloat(this.timeline.controls.end.input.step)),this.timeline.track.right.value=this.calcValBySliderTime(parseFloat(this.timeline.controls.end.input.value),this.timeline.track.right.min,this.timeline.track.right.max),this.timeline.track.right.oninput(),this.video.currentTime=parseFloat(this.timeline.controls.end.input.value)||0},this.timeline.track.left.oninput=()=>{parseInt(this.timeline.track.right.value)-parseInt(this.timeline.track.left.value)<=this.minGap&&(this.timeline.track.left.value=parseInt(this.timeline.track.left.value)-this.minGap);var t=this.timeline.track.bg.offsetWidth*this.timeline.track.left.value/(this.timeline.track.left.max-this.timeline.track.left.min);this.timeline.sliders.left.style.width=t+"px",this.timeline.controls.start.input.value=this.calcTimeBySliderVal(this.timeline.track.left.value,this.timeline.track.left.max,this.timeline.track.left.min),this.updateCutTimeInformation()},this.timeline.track.right.oninput=()=>{parseInt(this.timeline.track.right.value)-parseInt(this.timeline.track.left.value)<=this.minGap&&(this.timeline.track.right.value=parseInt(this.timeline.track.left.value)+this.minGap);var t=this.timeline.track.bg.offsetWidth-this.timeline.track.bg.offsetWidth*this.timeline.track.right.value/(this.timeline.track.right.max-this.timeline.track.right.min);this.timeline.sliders.right.style.width=t+"px",this.timeline.controls.end.input.value=this.calcTimeBySliderVal(this.timeline.track.right.value,this.timeline.track.right.max,this.timeline.track.right.min),this.updateCutTimeInformation()}}updateCutTimeInformation(){this.data.startTime=this.timeline.controls.start.input.value,this.data.endTime=this.timeline.controls.end.input.value}startTimeCalcVal(t){return t<0?t=0:t>this.duration&&(t=this.duration),t>this.timeline.controls.end.input.value&&(t=this.timeline.controls.end.input.value),parseFloat(t).toFixed(2)}endTimeCalcVal(t){return t<0?t=0:t>this.duration&&(t=this.duration),t<this.timeline.controls.start.input.value&&(t=this.timeline.controls.start.input.value),parseFloat(t).toFixed(2)}calcTimeBySliderVal(t,e,i){return Math.abs(t/(i-e)*this.duration).toFixed(2)}calcValBySliderTime(t,e,i){return Math.abs(t/this.duration*(i-e)).toFixed(2)}updateSliderSize(){var t=this.timeline.track.bg.offsetWidth*this.timeline.track.left.value/(this.timeline.track.left.max-this.timeline.track.left.min),t=(this.timeline.sliders.left.style.width=t+"px",this.timeline.track.bg.offsetWidth-this.timeline.track.bg.offsetWidth*this.timeline.track.right.value/(this.timeline.track.right.max-this.timeline.track.right.min));this.timeline.sliders.right.style.width=t+"px"}setupEventListeners(){this.loadedMetadata(),this.timeUpdate(),this.setControl(),window.addEventListener("resize",()=>{this.updateSliderSize()})}setControl(){this.isTouchDevice?this.videoContainer.addEventListener("click",this.switchToggle.bind(this)):(this.videoContainer.addEventListener("mouseover",()=>{this.watch&&this.video.play().catch(t=>{})}),this.videoContainer.addEventListener("mouseout",()=>{this.video.pause()}))}formatTime(t){return Math.floor(t/60)+":"+Math.floor(t%60).toString().padStart(2,"0")}switchToggle(){this.video.paused?this.watch&&this.video.play():this.video.pause()}async generateVideoThumbnails(r=10){let l=document.createElement("canvas"),o=document.createElement("video");o.autoplay=!0,o.muted=!0,o.src=this.src,o.crossOrigin="anonymous",o.onloadeddata=async()=>{var e=l.getContext("2d"),i=(l.width=o.videoWidth,l.height=o.videoHeight,this.video.offsetWidth/(60/l.height*l.width*10)),s=(o.pause(),o.duration/(r-1));for(let t=0;t<r;t++){var n=t*s;o.currentTime=n,await new Promise(t=>o.onseeked=t),e.clearRect(0,0,l.width,l.height),l.width=o.videoWidth*i,l.height=o.videoHeight;for(let t=0;t<i;t++)e.drawImage(o,t*o.videoWidth,0,o.videoWidth,o.videoHeight);var n=l.toDataURL("image/png"),n=await(await fetch(n)).blob(),n=URL.createObjectURL(n),a=document.createElement("div");a.classList.add("h-14","w-full","opacity-60"),a.style.backgroundSize="auto 100%",a.style.backgroundRepeat="repeat",a.style.backgroundImage=`url(${n})`,this.timeline.track.bg.appendChild(a)}}}async generateVideoMarkers(t=5){let i=this.timeline.markers.container,s=(i.innerHTML="",this.duration/t);t=Array.from({length:6},(t,e)=>this.formatTime(s*e));[...new Set(t)].forEach(t=>{var e=document.createElement("div");e.textContent=t,i.appendChild(e)})}timeUpdate(){this.video.addEventListener("timeupdate",()=>{this.timeline.controls.start.input.value>this.video.currentTime&&(this.video.currentTime=this.timeline.controls.start.input.value),this.video.currentTime>this.timeline.controls.end.input.value&&(this.video.currentTime=this.timeline.controls.start.input.value);var t=this.formatTime(this.video.currentTime),e=this.formatTime(this.duration);this.controls.duration.textContent=t+"/"+e,this.timeline.track.current.value=this.video.currentTime/this.duration*this.timeline.track.current.max})}loadedMetadata(){this.video.addEventListener("loadedmetadata",async()=>{this.video.pause(),this.video.muted=!1,this.data.naturalWidth=this.video.videoWidth,this.data.naturalHeight=this.video.videoHeight,this.data.offsetWidth=this.video.offsetWidth,this.data.offsetHeight=this.video.offsetHeight,this.data.fileSizeBytes>maxFileSize?this.duration=maxFileSize/this.data.fileSizeBytes*this.video.duration:this.duration=this.video.duration,this.data.startTime=0,this.data.endTime=this.duration,this.controls.duration.textContent="0:00/"+this.formatTime(this.duration),await this.generateVideoMarkers(),await this.generateVideoThumbnails(),this.timeline.controls.start.input.value=0,this.timeline.controls.start.input.max=this.duration.toFixed(2),this.timeline.controls.end.input.value=this.duration.toFixed(2),this.timeline.controls.end.input.max=this.duration.toFixed(2),this.video.currentTime=parseFloat(this.timeline.controls.start.input.value)||0;var t=Math.min((this.timeline.track.right.max-this.timeline.track.right.min)/this.duration,(this.timeline.track.left.max-this.timeline.track.left.min)/this.duration);this.minGap=t,this.loadOnInit||this.loaderContainer.classList.add("hidden")})}async stop(t=null){this.timeline.accessMessages.forEach(t=>{t.classList.remove("hidden")}),this.controls.watch&&(this.controls.watch.classList.remove("hover:bg-accent-hover","text-dark-background","bg-accent-primary"),this.controls.watch.classList.add("hover:bg-dark-elements-hover","text-light-primary","bg-dark-elements","!bg-dark-pop-up")),this.data.startTime!==this.startTime?(this.startTime=this.data.startTime,2<=this.video.readyState?this.video.currentTime=this.startTime:console.warn("Video is not ready to seek. Ensure it's fully loaded before attempting to capture frames.")):"function"==typeof t&&t(),this.video.pause(),this.video.currentTime=parseFloat(this.timeline.controls.start.input.value)||0}play(t=null){this.timeline.accessMessages.forEach(t=>{t.classList.add("hidden")}),"function"==typeof t&&t(),this.controls.watch&&(this.controls.watch.classList.remove("hover:bg-dark-elements-hover","text-light-primary","bg-dark-elements","!bg-dark-pop-up"),this.controls.watch.classList.add("hover:bg-accent-hover","text-dark-background","bg-accent-primary"))}}class SegmentVideoHandler extends VideoHandler{constructor(t){super(t),this.segments=[],this.currentSegmentIndex=0,this.playingSegments=!1,this.video.addEventListener("timeupdate",()=>this.handleSegmentPlayback()),this.container.querySelector(".video-timeline").classList.add("hidden")}createControlButtons(t){super.createControlButtons(t),t.isWatch&&this.controls.watch&&(this.controls.watch.onclick=async()=>{this.watch?(this.stop(),this.watch=!1,this.playingSegments=!1):(0<this.segments.length?(this.playSegments(),this.playingSegments=!0):this.play(),this.watch=!0)})}setSegments(t){this.segments=t.sort((t,e)=>t.start-e.start),this.currentSegmentIndex=0}playSegments(){this.segments.length?(this.controls.watch.classList.remove("hover:bg-dark-elements-hover","text-light-primary","bg-dark-elements","!bg-dark-pop-up"),this.controls.watch.classList.add("hover:bg-accent-hover","text-dark-background","bg-accent-primary"),this.video.pause(),this.currentSegmentIndex=0,this.playSegment(this.currentSegmentIndex)):(console.warn("There are no selected segments to play."),this.stopSegments())}playSegment(t){var e;t>=this.segments.length?this.stopSegments():({start:t,end:e}=this.segments[t],this.video.currentTime=t,this.video.paused&&this.video.play(),this.currentSegmentEnd=e)}handleSegmentPlayback(){var t;this.segments.length||this.stopSegments(),this.playingSegments&&this.segments.length&&(t=this.segments[this.currentSegmentIndex])&&this.video.currentTime>=t.end&&(this.currentSegmentIndex++,this.currentSegmentIndex<this.segments.length||(this.currentSegmentIndex=0),this.playSegment(this.currentSegmentIndex))}stopSegments(){this.video.pause(),this.currentSegmentIndex=0,this.playingSegments=!1,this.watch=!1,this.stop(),this.controls.watch.classList.add("hover:bg-dark-elements-hover","text-light-primary","bg-dark-elements","!bg-dark-pop-up"),this.controls.watch.classList.remove("hover:bg-accent-hover","text-dark-background","bg-accent-primary")}}customElements.define("notice-component",Notice),customElements.define("slider-component",SliderComponent),customElements.define("button-primary",ButtonComponentPrimary,{extends:"button"}),customElements.define("button-secondary",ButtonComponentSecondary,{extends:"button"}),customElements.define("button-mini",ButtonComponentMini,{extends:"button"});